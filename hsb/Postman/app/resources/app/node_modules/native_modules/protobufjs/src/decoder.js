"use strict";module.exports=decoder;var Enum=require("./enum"),types=require("./types"),util=require("./util");function missing(e){return"missing required '"+e.name+"'"}function decoder(e){var r=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&r("if((t&7)===4)")("break"),r("switch(t>>>3){");for(var s=0;s<e.fieldsArray.length;++s){var t=e._fieldsArray[s].resolve(),i=t.resolvedType instanceof Enum?"int32":t.type,a="m"+util.safeProp(t.name);r("case %i: {",t.id),t.map?(r("if(%s===util.emptyObject)",a)("%s={}",a)("var c2 = r.uint32()+r.pos"),void 0!==types.defaults[t.keyType]?r("k=%j",types.defaults[t.keyType]):r("k=null"),void 0!==types.defaults[i]?r("value=%j",types.defaults[i]):r("value=null"),r("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",t.keyType)("case 2:"),void 0===types.basic[i]?r("value=types[%i].decode(r,r.uint32())",s):r("value=r.%s()",i),r("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==types.long[t.keyType]?r('%s[typeof k==="object"?util.longToHash(k):k]=value',a):r("%s[k]=value",a)):t.repeated?(r("if(!(%s&&%s.length))",a,a)("%s=[]",a),void 0!==types.packed[i]&&r("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",a,i)("}else"),void 0===types.basic[i]?r(t.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",a,s):r("%s.push(r.%s())",a,i)):void 0===types.basic[i]?r(t.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",a,s):r("%s=r.%s()",a,i),r("break")("}")}for(r("default:")("r.skipType(t&7)")("break")("}")("}"),s=0;s<e._fieldsArray.length;++s){var u=e._fieldsArray[s];u.required&&r("if(!m.hasOwnProperty(%j))",u.name)("throw util.ProtocolError(%j,{instance:m})",missing(u))}return r("return m")}