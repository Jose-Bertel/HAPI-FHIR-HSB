exports.ids=["common_services_RuntimeExecutionService_js-node_modules_postman-runtime_lib_sync_recursive_pa-380f03"],exports.modules={"./common/services/GRPCClient.js":function(e,t,r){let{app:o,dialog:s,BrowserWindow:n}=r("electron"),i=r("./node_modules/postman-collection/index.js"),{URL:a}=r("url"),l=r("fs"),c=r("tls"),u=r("path"),d=r("util"),p=r("crypto"),h=r("./node_modules/uuid/index.js"),m=r("./node_modules/lodash/lodash.js"),g=r("./node_modules/postman-request/index.js"),f=r("./node_modules/@postman/grpc-js/build/src/index.js"),y=r("./node_modules/@postman/grpc-reflection-js/build/src/index.js"),b=r("./node_modules/@postman/proto-loader/build/src/index.js"),w=r("./node_modules/@postman/protobufjs/index.js"),C=r("./common/channels/EventChannel.js"),v=r("./common/utils/postmanFs.js"),x=r("./common/utils/pathIsInside.js");r.ab;let _={keepComments:!0},k={keepCase:!0,alternateCommentMode:!0,json:!0,enums:String,bytes:String,longs:String},S={grpc_proxy:process.env.grpc_proxy,http_proxy:process.env.http_proxy,https_proxy:process.env.https_proxy,no_grpc_proxy:process.env.no_grpc_proxy,no_proxy:process.env.no_proxy},R=function(){let e,t=new w.Root;return t.load([r.ab+"status.proto",r.ab+"error_details.proto"],k,r=>{if(r)return void pm.logger.error("GRPCClient~loadStatusRoot error: ",r);e=t.lookup("google.rpc.Status")}),function(t){if(e&&t instanceof Buffer)try{return e.decode(t).toJSON()}catch(e){return}}}();function P(e,t={}){let{host:r,pathname:o,protocol:s}=e;return{"grpc.max_send_message_length":-1,"grpc.max_receive_message_length":t.maxResponseMessageSize,"grpc.ssl_target_name_override":t.serverNameOverride,channelFactoryOverride:(e,t,n)=>"grpc:"===s&&o?new N(r,t,n,o):new f.Channel(e,t,n)}}async function T(e={},t,r,o,s={}){if(!0!==s.secureConnection)return t&&r&&r.merge(M(t)),f.credentials.createInsecure();if(!o)throw TypeError("Missing path to working directory");let n=new v(o),i=d.promisify(n.readFile.bind(n)),[a,l,u,p]=await Promise.all([e.ca&&i(e.ca),e.key&&i(e.key),e.client&&i(e.client),e.pfx&&i(e.pfx)]),h=c.createSecureContext({key:l||void 0,cert:u||void 0,pfx:p||void 0,passphrase:e.passphrase||void 0});a&&h.context.addCACert(a);let m=f.credentials.createFromSecureContext(h);!0!==s.strictSSL&&(m.connectionOptions.rejectUnauthorized=!1);let g=t&&M(t),y=g&&f.credentials.createFromMetadataGenerator((e,t)=>{t(null,g)});return f.credentials.combineChannelCredentials(m,y)}function M(e={}){if(!e.type||!e[e.type])throw Error("Invalid auth format");let t=new f.Metadata,r=new i.RequestAuth(e).parameters(),o="",s="";switch(e.type){case"basic":o="Authorization",s="Basic "+Buffer.from(`${r.get("username")||""}:${r.get("password")||""}`,"utf8").toString("base64");break;case"bearer":o="Authorization",s=`Bearer ${r.get("token")||""}`;break;case"apikey":if(o=r.get("key")||"",s=r.get("value")||"",!o.trim())throw Error('Invalid metadata with empty key in "API Key" auth');break;case"oauth2":o="Authorization",s=`${r.get("headerPrefix")||"Bearer"} ${r.get("accessToken")||""}`;break;default:throw Error(`Unsupported authorization type: ${e.type}`)}return t.add(o,s),t}function j(e){let t=new f.Metadata;for(let{key:r,value:o}of e){let e=String(o||"");r.toLowerCase().endsWith("-bin")&&(e=Buffer.from(e,"base64")),t.add(r,e)}return t}function E(e){let t=[];for(let[r,o]of Object.entries(e.toJSON()))for(let e of o)Buffer.isBuffer(e)&&(e=e.toString("base64")),t.push({key:r,value:e});return t}function $(e,t,r={}){let o=!0===t?`https://${e}`:`http://${e}`;for(let e in S)process.env[e]&&delete process.env[e];let s=new i.ProxyConfigList({},r.proxyConfigList).resolve(o);if(s){process.env.grpc_proxy=s.getProxyUrl();return}if(r.useSystemProxy,!r.ignoreProxyEnvironmentVariables)for(let e in S)S[e]&&(process.env[e]=S[e])}function q(e){let t,r=(e=e.replace(/^(grpc:)?\/\//i,"")).match(/^([a-z0-9+.-]+):\/\//i),o=r&&r[1];if(o&&"unix"!==o)throw Error(`Invalid protocol "${o}", try "grpc://" instead`);e=e.startsWith("unix:")?e:`grpc://${e}`;try{t=new a(e)}catch(t){throw new z(`Invalid URL "${e}"`,"ERR_INVALID_URL")}return{host:"unix:"===t.protocol?t.href:t.host,pathname:t.pathname,protocol:t.protocol}}function A(e){try{return l.accessSync(e,l.constants.R_OK),!0}catch(e){return!1}}function I(e){let t=/\b(proto|package|service|message)\b/i,r=String(e);if(!t.test(r)){let r=e.toString("utf16le");if(t.test(r))return r}return r}function O(e,t){return t.endsWith(u.sep)&&(t=t.slice(0,-1)),e.endsWith(u.sep)||(e+=u.sep),t.startsWith(e)}function L(e,t){let r=u.join(e,t);return O(e,r)?r:null}function F(e,t,r){let o=0,s=0;do{let n=e.content.indexOf(t,o);if(-1===n)break;e.content=e.content.slice(0,n)+r+e.content.slice(n+t.length),o=n+r.length,s+=1}while(o<e.content.length);return s}function U(e,t='"'){return t+e.replace(/\\/g,"\\\\")+t}function D(e){e.metadata||pm.logger.error("GRPCClient~unexpectedError: ",e)}class N extends f.Channel{constructor(e,t,r,o){super(e,t,r),this._prefix=o}createCall(e,...t){return this._prefix&&"/"!==this._prefix&&(e=`${this._prefix}${e}`),super.createCall(e,...t)}}class z extends Error{constructor(e,t){super(e),this.code=t}}e.exports=class{constructor(e){this.defaultWorkingDir=e}async openProtoSelectorDialog(e){var t,r;"darwin"===process.platform&&o.focus({steal:!0});let{filePaths:i}=await s.showOpenDialog(n.getFocusedWindow(),{filters:[{name:"Protobuf",extensions:["proto"]}],properties:["openFile","treatPackageAsDirectory"]});return t=i[0],((x(t,r=e||this.defaultWorkingDir)&&(t=u.relative(r,t)),"win32"===global.process.platform&&t)?(u.win32.isAbsolute(t)&&"/"!==t[0]&&(t=`\\${t}`),t.split(u.win32.sep).join(u.posix.sep)):t)||null}async openFolderSelectorDialog(){"darwin"===process.platform&&o.focus({steal:!0});let{filePaths:e}=await s.showOpenDialog(n.getFocusedWindow(),{properties:["openDirectory","multiSelections","treatPackageAsDirectory"]});return e}async loadProtoFromFilename(e,t=[],o){let s=new w.Root,n=new Map,i=[];e=new v(o||this.defaultWorkingDir,!0).resolvePathSync(e),t=[...t,r.ab+"protobufjs"];let a=s.resolvePath;return s.resolvePath=(e,r)=>{let o=((e,r)=>{if(u.isAbsolute(r)){if(A(r))return r}else for(let o of[a(e,r),...t.map(e=>L(e,r)).filter(Boolean)])if(A(o))return o;let o=Error(`unresolved import: ${r}`);throw o.code="UNRESOLVED_IMPORT",o.filename=r,o})(e,r);if(e){let t=n.get(e);t||n.set(e,t=new Map),t.set(r,o)}return o},s.fetch=(e,t)=>{l.readFile(e,(r,o)=>{if(r)t(r);else{let r=I(o);i.push({filename:e,content:r,isRoot:!i.length}),t(null,r)}})},await s.load(e,k),s.resolveAll(),{files:function(e,t){e=e.filter(e=>!O(r.ab+"protobufjs",e.filename));let o=u.dirname(e[0].filename);e:for(let t of e)for(;!O(o,t.filename);){let e=u.dirname(o);if(e!==o)o=e;else{o="";break e}}let s=o.length+(o&&!o.endsWith(u.sep)?1:0),n=new Map;for(let t of e)n.set(t,t.filename.slice(s).split(u.sep));t:for(;;){let e=new Map;for(let t of n.values()){if(t.length<3)break t;let[r,o]=t;if(e.has(o)&&e.get(o)!==r)break t;e.set(o,r)}for(let e of n.values())e.splice(0,1)}let i=new Map(e.map(e=>{let t=n.get(e).join("/");return[e.filename,t]}));for(let o of e){let e=u.posix.dirname(i.get(o.filename));for(let[s,n]of t.get(o.filename)||new Map){if(O(r.ab+"protobufjs",n))continue;let t=u.posix.relative(e,i.get(n));if(!(F(o,U(s,'"'),U(t,'"'))+F(o,U(s,"'"),U(t,"'"))))throw Error("failed to process import statements")}o.filename=i.get(o.filename)}return e}(i,n),descriptor:s.toJSON(_)}}async loadFromServerReflection({url:e,certs:t,auth:r,metadata:o=[],workingDir:s,options:n,proxyOptions:i,useExperimentalMapFieldDecoding:a}){let{host:l}=e=q(e);$(l,n?.secureConnection,i);let c=j(o),u=P(e,n),d=await T(t,r,c,s||this.defaultWorkingDir,n),p=new y.Client(l,d,u,c,{useExperimentalMapFieldDecoding:a}),h=await p.listServices();return{files:[],descriptor:(await Promise.all(h.filter(e=>e&&"grpc.reflection.v1alpha.ServerReflection"!==e&&"grpc.reflection.v1.ServerReflection"!==e).map(e=>p.fileContainingSymbol(e).then(e=>e&&e.toJSON(_))))).reduce((e,t)=>(t&&m.merge(e.nested,t.nested),e),{nested:{}})}}async loadProtoFromURL(e){let t=new w.Root,r=new Map,o=[],s=t.resolvePath;return t.resolvePath=(e,t)=>{let o=((e,t)=>{if(/^https?:\/\//i.test(t))return t;let r=new a(e);return r.pathname=s(r.pathname,t),r.toString()})(e,t);if(e){let s=r.get(e);s||r.set(e,s=new Map),s.set(t,o)}return o},t.fetch=(e,t)=>{g(e,{timeout:5e3},(r,s,n)=>{if(r)t(r);else if(s.statusCode>=300)t(Error(`GET failed with ${s.statusCode} ${s.statusMessage} (${e})`));else{let r=String(n);o.push({filename:e,content:r,isRoot:!o.length}),t(null,r)}})},await t.load(e,k),t.resolveAll(),{files:function(e,t){let r=new Map;for(let t of e){let e=new a(t.filename),o=`${e.host}/${e.pathname.slice(1)||"_index"}`,s=o;for(;r.has(s);)s=`${o}-${function(e=6){return p.randomBytes(e).toString("base64").replace(/\//g,"_")}()}`;r.set(t.filename,s)}for(let o of e){let e=u.posix.dirname(r.get(o.filename));for(let[s,n]of t.get(o.filename)||new Map){let t=u.posix.relative(e,r.get(n));if(!(F(o,U(s,'"'),U(t,'"'))+F(o,U(s,"'"),U(t,"'"))))throw Error("failed to process import statements")}o.filename=r.get(o.filename)}return e}(o,r),descriptor:t.toJSON(_)}}async loadProtoFromMemory(e){if(0===e.length)throw Error("Definition is empty");1===e.length&&null===e[0].filename&&(e=[{...e[0],filename:"Protobuf"}]);let t=e.filter(e=>e.isRoot);if(!t.length)throw Error("no root files");let o=new w.Root,s=new Map(e.map(e=>[e.filename,e.content])),n=o.resolvePath;return o.resolvePath=(e,t)=>{if(u.posix.isAbsolute(t)){if(s.has(t.slice(1)))return t.slice(1)}else{let o=n(e,t);if(s.has(o))return o;let i=L(r.ab+"protobufjs",t);if(i&&A(i))return i}let o=Error(`unresolved import: ${t}`);throw o.code="UNRESOLVED_IMPORT",o.filename=t,o},o.fetch=(e,t)=>{s.has(e)?setImmediate(()=>{t(null,s.get(e))}):l.readFile(e,(e,r)=>{e?t(e):t(null,I(r))})},await o.load(t.map(e=>e.filename),k),o.resolveAll(),{files:e,descriptor:o.toJSON(_)}}async loadProtoFromString(e){let t=new w.Root,r=h.v4();t.fetch=(t,o)=>{setImmediate(()=>{t===r?o(null,e):o(Error(`unresolved import: ${t}`))})};try{await t.load(r,k),t.resolveAll()}catch(e){throw e.message=e.message.replace(RegExp(`\\b${r}\\b(, *)?`,"g"),""),e}return{files:[{filename:null,content:e,isRoot:!0}],descriptor:t.toJSON(_)}}async request({location:e,message:t,metadata:r=[],options:o,proxyOptions:s,certs:n,auth:i,workingDir:a}){let l=b.fromJSON(e.descriptor,{...k,defaults:!!o?.includeDefaultFields}),c=f.loadPackageDefinition(l),u=m.get(c,e.service);if(!u)throw Error(`No gRPC service: ${e.service}`);let d=q(e.url),{host:p}=d;$(p,o?.secureConnection,s);let h=j(r),g=P(d,o),y=function(e){let{connectionTimeout:t}=e;return t?{deadline:new Date(Date.now()+t)}:{}}(o),w=new u(p,await T(n,i,h,a||this.defaultWorkingDir,o),g),v=w[e.method];if("function"!=typeof v)throw Error(`No gRPC method: ${e.method}`);let x=[h,y],_=new C;v.requestStream||(t&&Object.setPrototypeOf(t,null),x.unshift(t)),v.responseStream||x.push((e,t)=>{e?D(e):_.emit("responseData",{data:t})});let S=v.apply(w,x).on("metadata",e=>{e=E(e),_.emit("responseStarted",{metadata:e,host:p})}).on("status",({code:e,details:t,metadata:r})=>{let o=R(r.get("grpc-status-details-bin")[0]);r=E(r),_.emit("status",{code:e,codeName:f.status[e],metadata:r,message:t,details:o?.details}),_.destroy()}).on("data",e=>{_.emit("responseData",{data:e})}).on("error",D);return _.addCleanup(()=>{S.cancel()}).on("cancel",()=>{S.cancel()}).on("write",e=>{S.writable&&(e&&Object.setPrototypeOf(e,null),S.write(e),_.emit("requestData",{data:e}))}).on("end",()=>{S.writable&&S.end()}),setImmediate(()=>{let e=E(j(r));_.emit("requestStarted",{metadata:e,host:p}),v.requestStream||_.emit("requestData",{data:t})}),_}}},"./common/channels/EventChannel.js":function(e,t,r){let o=r("./common/channels/LinkableChannel.js"),s=Symbol(),n=Symbol();class i extends o{constructor(){super(),this[s]=new Map,this[n]=[],this.addCleanup(()=>{this[s].clear(),this[n].splice(0)})}on(e,t){if("string"!=typeof e)throw TypeError("Expected event name to be a string");if("function"!=typeof t)throw TypeError("Expected event listener to be a function");if(!this.isDestroyed()){let r=this[s].get(e);r?r.push(t):this[s].set(e,[t])}return this}off(e,t){if("string"!=typeof e)throw TypeError("Expected event name to be a string");if("function"!=typeof t)throw TypeError("Expected event listener to be a function");let r=this[s].get(e);if(r){let o=r.indexOf(t);-1!==o&&(1===r.length?this[s].delete(e):r.splice(o,1))}return this}receive(e,t){if("string"!=typeof e)throw TypeError("Expected event name to be a string");if(this.isDestroyed())return;for(let r of this[n])r(e,t);let r=this[s].get(e);if(r)for(let e of[...r])e(t)}async *[Symbol.asyncIterator](){if(this.isDestroyed())return;let e=!1,t=[],r=()=>{};this[n].push((o,s)=>{e||(t.push(s),r())}),this.addCleanup(()=>{e=!0,r()});try{do for(await new Promise(e=>{r=e});t.length;)yield t.shift();while(!e)}finally{e=!0,t=[],r=()=>{},this.destroy()}}}e.exports=i},"./common/services/CookieJar.js":function(e,t,r){let{CookieJar:o}=r("./node_modules/@postman/tough-cookie/lib/cookie.js"),{UrlMatchPatternList:s}=r("./node_modules/postman-collection/index.js"),n=r("./common/services/CookieStore.js");e.exports=class extends o{constructor(e,t){"object"!=typeof t&&(t={});let r=new n(e,t.readFromDB,t.writeToDB),o=Array.isArray(t.programmaticAccess)?t.programmaticAccess:[],i=[];super(r,{rejectPublicSuffixes:!1,looseMode:!0}),o.forEach(e=>{"string"==typeof e&&(e=e.toLowerCase().trim())&&i.push(`http://${e}/*`)}),this.onCookieAccessDenied=t.onCookieAccessDenied,this.whitelistedDomains=new s(null,i)}updateStore(e){"function"!=typeof e&&(e=function(){}),this.store.flushToStore(e)}allowProgrammaticAccess(e){let t=this.whitelistedDomains.test("http://"+e);return t||"function"!=typeof this.onCookieAccessDenied||this.onCookieAccessDenied(e),t}}},"./common/services/CookieStore.js":function(e,t,r){let o,{Store:s,Cookie:n,pathMatch:i,permuteDomain:a}=r("./node_modules/@postman/tough-cookie/lib/cookie.js"),l="string",c="function",u="boolean",d=Symbol("cached");function p(e,t,r){if(r||(r=function(){}),!(Array.isArray(e)&&t))return r();let o=0,s=e.length,n=function(i){if(i||o>=s)return r(i);try{t.call(e,e[o++],n)}catch(e){return r(e)}};if(!s)return r();n()}class h{constructor(e){if(!e)throw Error("PersistentStore: CookieStorageRemoteClient is missing.");this.cookieStorageRemoteClient=e}static serializeDomain(e){return typeof e!==l||"["===e[0]&&"]"===e[e.length-1]&&(e=e.substring(1,e.length-1)),e}static deserializeDomain(e){return typeof e!==l||-1!==e.indexOf(":")&&(e=`[${e}]`),e}static serialize(e){if(e)return n.fromJSON({key:e.name,value:e.value,expires:-1===e.expires?void 0:new Date(e.expires),domain:h.serializeDomain(e.domain),path:e.path,secure:e.secure,httpOnly:e.httpOnly,hostOnly:e.hostOnly,sameSite:e.sameSite})}static deserialize(e){if(!(e&&e.domain))return;let t=e.expiryTime();return t===1/0?t=-1:Number.isFinite(t)||(t=0),{name:e.key,value:e.value,domain:h.deserializeDomain(e.domain),path:e.path,secure:e.secure,httpOnly:e.httpOnly,hostOnly:e.hostOnly,expires:t,sameSite:e.sameSite}}get(e,t){typeof t===c&&("object"!=typeof e&&(e={}),e.domain&&(e.domain=h.deserializeDomain(e.domain)),this.cookieStorageRemoteClient.get(e).then(e=>Array.isArray(e)?t(null,e.map(h.serialize)):t(null,[]),e=>t(e,[])))}set(e,t){let r=h.deserialize(e);if(!r)return t(Error("invalid cookie"));this.cookieStorageRemoteClient.set(r).then(()=>t(),t)}remove(e,t){let r=h.deserialize(e);if(!r)return t(Error("invalid cookie"));this.cookieStorageRemoteClient.remove(r).then(()=>t&&t()).catch(e=>t&&t(e))}}e.exports=class extends s{constructor(e,t,r){super(),this.synchronous=!1,this.idx={},this.deletedCookies={},this.readFromDB=typeof t!==u||t,this.writeToDB=typeof r!==u||r,o=new h(e)}_cache(e,t,r){if(typeof t!==c||r||(r=t,t=null),typeof r===c){if(this.idx[d]||this.idx[e]&&this.idx[e][d]||this.idx[e]&&this.idx[e][t])return r(null);if(!e&&t||e&&typeof e!==l)return r(Error("invalid domain"));if(e&&t&&typeof t!==l)return r(Error("invalid path"));if(e&&!this.idx[e]&&(this.idx[e]={}),e||(this.idx[d]=!0),e&&!t&&(this.idx[e][d]=!0),e&&t&&!this.idx[e][t]&&(this.idx[e][t]={}),!this.readFromDB)return r(null);o.get({domain:e,path:t},(e,t)=>{if(e||!Array.isArray(t))return r(e);t.forEach(e=>{this.idx[e.domain]||(this.idx[e.domain]={}),this.idx[e.domain][e.path]||(this.idx[e.domain][e.path]={}),this.idx[e.domain][e.path][e.key]||(this.idx[e.domain][e.path][e.key]=e)}),r(null)})}}_update(e,t){typeof t!==c&&(t=function(){});let{domain:r,path:s,key:n}=e;if(r&&!this.idx[r]&&(this.idx[r]={}),r&&s&&!this.idx[r][s]&&(this.idx[r][s]={}),!this.writeToDB)return this.idx[r][s][n]=e,t(null);o.set(e,o=>{if(o)return t(o);this.idx[r][s][n]=e,t(null)})}_unset(e,t){typeof t!==c&&(t=function(){});let{domain:r,path:s,key:n}=e;if(!this.writeToDB)return this.deletedCookies[`${r}#${s}#${n}`]=e,delete this.idx[r][s][n],t(null);o.remove(e,e=>{if(e)return t(e);delete this.idx[r][s][n],t(null)})}_getAll(){let e=[],t=this.idx;return Object.keys(t).forEach(r=>{Object.keys(t[r]).forEach(o=>{Object.keys(t[r][o]).forEach(s=>{null!==s&&e.push(t[r][o][s])})})}),e.sort((e,t)=>(e.creationIndex||0)-(t.creationIndex||0)),e}flushToStore(e){p(Object.values(this.deletedCookies),(e,t)=>{o.remove(e,t)},()=>{p(this._getAll(),(e,t)=>{o.set(e,t)},e)})}findCookie(e,t,r,o){this._cache(e,t,()=>this.idx[e]&&this.idx[e][t]?o(null,this.idx[e][t][r]||null):o(null,void 0))}findCookies(e,t,r,o){if(!e)return o(null,[]);typeof r===c&&(o=r,r=!0);let s,n=[],l=a(e,r)||[e];s=t?function(e){Object.keys(e).forEach(function(r){if(i(t,r)){let t=e[r];for(let e in t)n.push(t[e])}})}:function(e){for(let t in e){let r=e[t];for(let e in r)n.push(r[e])}},p(l,(e,t)=>{this._cache(e,()=>{this.idx[e]&&s(this.idx[e]),t()})},e=>{if(e)return o(e);o(null,n)})}putCookie(e,t){let{domain:r,path:o}=e;this._cache(r,o,()=>{this._update(e,t)})}updateCookie(e,t,r){this.putCookie(t,r)}removeCookie(e,t,r,o){this._cache(e,t,()=>{if(!(this.idx[e]&&this.idx[e][t]&&this.idx[e][t][r]))return o(null);this._unset(this.idx[e][t][r],o)})}removeCookies(e,t,r){this._cache(e,t,()=>{if(!this.idx[e]||!this.idx[e][t])return r(null);let o=[];Object.keys(this.idx[e][t]).forEach(r=>{null!==r&&o.push(this.idx[e][t][r])}),p(o,this._unset,r)})}removeAllCookies(e){throw Error("removeAllCookies is not implemented")}getAllCookies(e){this._cache(null,()=>{e(null,this._getAll())})}}},"./common/services/FileSystem.js":function(e,t,r){let{app:o,dialog:s,BrowserWindow:n}=r("electron"),i=r("path"),a=r("./common/utils/pathIsInside.js"),l=r("fs").promises,c=r("./node_modules/postman-request/index.js"),u=r("./utils/getSystemProxy.js"),d=r("./common/utils/postmanFs.js"),{promisify:p}=r("util");async function h(e,{cwd:t}){let[r,o,s]=await Promise.all([e.crt?m(e.crt,{cwd:t}):void 0,e.key?m(e.key,{cwd:t}):void 0,e.pfx?m(e.pfx,{cwd:t}):void 0]);return{crt:r,key:o,pfx:s,passphrase:e.passphrase}}async function m(e,{cwd:t}){let r=new d(t);return p(r.readFile.bind(r))(e)}async function g(e){return new Promise((t,r)=>{u(e,(e,o)=>{if(e)return r(e);t(o?.getProxyUrl())})})}e.exports=class{constructor(e){this.defaultWorkingDir=e}async showOpenFilePicker(e){"darwin"===process.platform&&o.focus({steal:!0});let t=["openFile","treatPackageAsDirectory"];e.multiple&&t.push("multiSelections");let r=await s.showOpenDialog(n.getFocusedWindow(),{filters:e.types,properties:t});return r.canceled?null:r.filePaths?r.filePaths.map(t=>{var r,o;return(a(r=t,o=e.cwd||this.defaultWorkingDir)&&(r=i.relative(o,r)),"win32"===global.process.platform&&r)?(i.win32.isAbsolute(r)&&"/"!==r[0]&&(r=`\\${r}`),r.split(i.win32.sep).join(i.posix.sep)):r}):(pm.logger.error("FileSystem~showOpenFilePicker error: ","No file selected"),null)}async showDirectoryPicker(e={}){"darwin"===process.platform&&o.focus({steal:!0});let{filePaths:t}=await s.showOpenDialog(n.getFocusedWindow(),{properties:["openDirectory","treatPackageAsDirectory",...e.multiple?["multiSelections"]:[]]});return t}async readFile(e,{cwd:t}){try{let r=new d(t,!0).resolvePathSync(e);return await l.readFile(r,"utf-8")}catch(t){throw Error(`Error reading file at ${e}: ${t.message}`,"INTERNAL_ERROR")}}async readURL(e,t={}){let{followRedirects:r=!0,verifySSLCertificates:o=!0,proxy:s={system:!0,env:!0},cwd:n=this.defaultWorkingDir,timeout:i=1e4}=t,a=t.ca||t.certificate?.ca?await m(t.ca||t.certificate?.ca,{cwd:n}):void 0,l=t.certificate?await h(t.certificate,{cwd:n}):{},u=!!s.env&&void 0,d=s.system?await g(e):void 0,p=s.url??d??u;return new Promise((t,s)=>{c.get({url:e,timeout:i,followRedirect:r,followAllRedirects:r,strictSSL:o,ca:a,cert:l?.crt,key:l?.key,pfx:l?.pfx,passphrase:l?.passphrase,proxy:p},(e,r,o)=>{e?(pm.logger.error(e),s(e)):r.statusCode>=200&&r.statusCode<300?t(o):s(Error(`Unsuccessful request, ${r.statusCode} ${r.statusMessage}`))})})}}},"./common/services/GraphQLClient.js":function(e,t,r){let o=r("./node_modules/lodash/lodash.js"),{URL:s}=r("url"),{EventEmitter:n}=r("events"),{promisify:i}=r("util"),{getIntrospectionQuery:a,parse:l,visit:c}=r("./node_modules/graphql/index.mjs"),{createClient:u}=r("./node_modules/graphql-ws/lib/index.js"),{SubscriptionClient:d}=r("./node_modules/subscriptions-transport-ws/dist/index.js"),p=r("./node_modules/postman-ws/index.js"),h=r("./node_modules/postman-request/index.js"),m=r("./node_modules/postman-collection/index.js"),{authorizeRequest:g}=r("./node_modules/postman-runtime/lib/authorizer/index.js"),{makePushPullAsyncIterableIterator:f}=r("./node_modules/@n1ru4l/push-pull-async-iterable-iterator/index.js"),y=r("./common/channels/EventChannel.js"),b=r("./common/utils/postmanFs.js"),w=r("./utils/getSystemProxy.js");async function C(e,t){let{url:r,auth:s,headers:n,operationType:i,followRedirects:a=!0,verifySSLCertificates:l=!1,cwd:c,proxy:u={system:!0,env:!0}}=t,d=new y,p=S(n,await k(r,s,e)),m=t.certificate?await P(t.certificate,{cwd:c}):{},g=!!u.env&&void 0,f=u.system?await M(r):void 0,b=u.url??f??g,w=h.post({url:x(r),headers:p,body:JSON.stringify(e),time:!0,followRedirect:a,followAllRedirects:a,strictSSL:l,...m,proxy:b},()=>{});return setImmediate(()=>{j(d,"sent-request",{...e,operationType:i}),j(d,"transport:http:sent-request",function(e,t=!1){let r={method:e.method,headers:Object.entries(e.headers).map(([e,t])=>({key:e,value:String(t)})),sizes:{headers:Buffer.byteLength(Object.entries(e.headers).flat().join(""))+3*Object.keys(e.headers).length,body:Buffer.byteLength(e.body||"")}};return t&&(r.body=e.body),r}(w))}),w.on("error",e=>{pm.logger.error(e),j(d,"error",{error:{message:e.message||"An unknown error occurred"}}),d.destroy()}).on("complete",e=>{j(d,"transport:http:received-response",function(e,t=!1){let r={statusCode:e.statusCode,statusMessage:e.statusMessage,headers:o.chain(e.rawHeaders).chunk(2).map(([e,t])=>({key:e,value:t})).value(),sizes:{headers:Buffer.byteLength(e.rawHeaders.join(""))+e.rawHeaders.length/2*3,body:Buffer.byteLength(e.body||"")},timings:e.timings};return t&&(r.body=e.body),r}(e,!0));let t=function(e){let t;try{t=JSON.parse(e)}catch(e){return null}return E(t)?t:null}(e.body);t?(j(d,"received-response",t),j(d,"ended",{cancelled:!1})):j(d,"error",{error:{message:e.statusCode>=300?`Unsuccessful GraphQL request, ${e.statusCode} ${e.statusMessage}`:"Received an invalid GraphQL response"}}),d.destroy()}),d.addCleanup(()=>w.abort()).on("cancel",()=>{j(d,"ended",{cancelled:!0}),d.destroy()}),d}async function v(e,{url:t,auth:r,headers:s,legacySubscriptions:i=!1,followRedirects:a=!0,verifySSLCertificates:l=!1,certificate:c,cwd:h}){var m,g;let f,b;t=x(t,!0),s=S(s,await k(t,r,e));let w=c?await P(c,{cwd:h}):{},C=new y,v=new n,_=(m={headers:s,followRedirects:a,rejectUnauthorized:l,...w},g=v,class extends p{constructor(e,t){super(e,(m?.headers?Object.entries(m.headers):[]).find(([e])=>"sec-websocket-protocol"===e.toLowerCase())?.[1].split(",").map(e=>e.trim())??t,m),g&&(this.on("open",(...e)=>g.emit("open",this,...e)),this.on("close",(...e)=>g.emit("close",this,...e)),this.on("error",(...e)=>g.emit("error",this,...e)))}getHandshakeRequest(){return this._debug?this._debug[0].request:void 0}getHandshakeResponse(){return this._debug?this._debug[this._debug.length-1].response:void 0}});if(i){let r=new d(t,void 0,_);b=()=>r.close(),f=$(t=>r.request(e).subscribe(t).unsubscribe)}else{let r=u({url:t,webSocketImpl:_});b=()=>r.dispose().catch(pm.logger.error.bind(pm.logger)),f=$(t=>r.subscribe(e,{...t,error:e=>{var r;E(r=e)&&"code"in r&&"reason"in r?t.complete():t.error(e)}}))}setImmediate(()=>{j(C,"sent-request",{...e,operationType:"subscription"})});let T=!1,M=null;return Promise.resolve().then(async()=>{for await(let e of f)j(C,"received-response",o.pick(e,["data","errors","extensions"]))}).catch(e=>{Array.isArray(e)?j(C,"received-response",{errors:e}):M=e}),v.on("open",e=>{T=!0,j(C,"transport:ws:connected",R(e))}).on("error",(e,t)=>{let r={error:{message:t.message||"An unknown error occurred"}};T?(j(C,"transport:ws:error",r),M=M||t):(j(C,"transport:ws:error",{...r,...R(e)}),j(C,"error",r),C.destroy())}).on("close",(e,t,r)=>{j(C,"transport:ws:disconnected",{code:t,reason:r}),M?j(C,"error",{error:{message:M.message||"An unknown error occurred"}}):j(C,"ended",{cancelled:!1}),C.destroy()}),C.addCleanup(b).on("cancel",()=>{j(C,"ended",{cancelled:!0}),C.destroy()}),C}function x(e,t){let r,o=t?["ws:","wss:"]:["http:","https:"];/^[a-z0-9+.-]+:\/\//i.test(e)||(e=o[0]+"//"+e);try{r=new s(e)}catch(r){let t=Error(`Invalid URL: ${e}`);throw t.code="ERR_INVALID_URL",t}if(t?r.protocol=r.protocol.replace(/^http(?=s?:$)/,"ws"):r.protocol=r.protocol.replace(/^ws(?=s?:$)/,"http"),!o.includes(r.protocol)){let e=r.protocol.replace(/:$/,""),t=o[0]+"//",s=Error(`Invalid protocol "${e}", try "${t}" instead`);throw s.code="ERR_INVALID_URL",s}return e}let _=new Set(["noauth","awsv4","basic","bearer","hawk","oauth1","oauth2","apikey","edgegrid"]);async function k(e,t,r){if(!t)return null;if(!t.type||!t[t.type]&&"noauth"!==t.type)throw Error("Invalid auth format");if(!_.has(t.type))throw Error(`Unsupported authorization type: ${t.type}`);return new Promise((s,n)=>{g(new m.Request({url:e,auth:t,method:"POST",body:JSON.stringify(r)}),(e,t)=>{e?n(e):s(o.fromPairs(t.headers.toJSON().map(e=>[e.key,e.value])))})})}function S(e,...t){let r=new Map;for(let[t,o]of Object.entries(e||{}))r.set(t.toLowerCase(),{key:t,value:o});for(let e of t)for(let[t,o]of Object.entries(e||{}))r.set(t.toLowerCase(),{key:t,value:o});let o={};for(let{key:e,value:t}of r.values())o[e]=t;return o}function R(e){return o.omitBy({handshakeRequest:o.pick(e.getHandshakeRequest(),["method","headers"]),handshakeResponse:o.pick(e.getHandshakeResponse(),["statusCode","statusMessage","headers"])},o.isEmpty)}async function P(e,{cwd:t}){let[r,o,s,n]=await Promise.all([e.ca?T(e.ca,{cwd:t}):void 0,e.cert?T(e.cert,{cwd:t}):void 0,e.key?T(e.key,{cwd:t}):void 0,e.pfx?T(e.pfx,{cwd:t}):void 0]);return{ca:r,cert:o,key:s,pfx:n,passphrase:e.passphrase}}async function T(e,{cwd:t}){let r=new b(t),o=i(r.readFile.bind(r));return await o(e)}async function M(e){return new Promise((t,r)=>{w(e,(e,o)=>{if(e)return r(e);t(o?.getProxyUrl())})})}function j(e,t,r){e.emit(t,{type:t,timestamp:new Date().toISOString(),payload:r})}function E(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function $(e){let t,{pushValue:r,asyncIterableIterator:o}=f(),s=e({next:e=>{r(e)},complete:()=>{o.return().catch(()=>{})},error:e=>{o.throw(e).catch(()=>{})}}),n=o.return;return o.return=()=>(void 0===t&&(s(),t=n()),t),o}e.exports=class{constructor(e){this.cwd=e}async getFromURL(e){return new Promise((t,r)=>{h(e,{timeout:1e4},(o,s,n)=>{o?r(o):s.statusCode>=300?r(Error(`GET failed with ${s.statusCode} ${s.statusMessage} (${e})`)):t(String(n))})})}async introspect({url:e,auth:t,headers:r},o={}){let s={operationName:"IntrospectionQuery",query:a()},n=await this.execute(s,{url:e,auth:t,headers:r,...o});return n.link(n),new Promise((e,t)=>{n.on("received-response",t=>e(t.payload)),n.on("error",e=>t(Error(e.payload.error.message)))})}async execute(e,t){let r=function({query:e,operationName:t}){let r="query";if(e)try{c(l(e),{OperationDefinition:e=>{t===e.name?.value&&(r=e.operation)}})}catch(e){}return r}(e);if(e=o.omitBy(e,o.isNil),t={...t,operationType:r,cwd:this.cwd},"query"===r||"mutation"===r)return C(e,t);if("subscription"===r)return v(e,t);throw Error(`Unrecognized operation type: ${r}`)}}},"./common/services/LLMClient.js":function(e,t,r){let{createOpenAI:o}=r("./node_modules/@ai-sdk/openai/dist/index.js"),{createDeepSeek:s}=r("./node_modules/@ai-sdk/deepseek/dist/index.js"),{createGoogleGenerativeAI:n}=r("./node_modules/@ai-sdk/google/dist/index.js"),{createAnthropic:i}=r("./node_modules/@ai-sdk/anthropic/dist/index.js"),{createXai:a}=r("./node_modules/@ai-sdk/xai/dist/index.js"),{generateText:l,streamText:c,APICallError:u,jsonSchema:d,tool:p,stepCountIs:h}=r("./node_modules/ai/dist/index.js"),m=r("tls"),{Agent:g,ProxyAgent:f}=r("./node_modules/undici/index.js"),{callTool:y,getServerById:b,getToolsByOrigin:w}=r("./common/services/MCPConnectionManager.js"),C=r("./common/channels/EventChannel.js"),v=r("./common/services/RuntimeClientUtilities.js"),x={openai:o,anthropic:i,deepseek:s,google:n,xai:a},_={openai:{compatibility:"strict"}};function k(e){let t;pm.logger.info(`[LLMClient] Getting tools for origin: ${e}`);let r=w(e,!0);return pm.logger.info(`[LLMClient] Found ${r.length} enabled tool entries for origin ${e}`),r.length>0?(pm.logger.info("[LLMClient] Tool entries details:",r.map(e=>({id:e.id,toolName:e.tool.name,enabled:e.enabled,origin:e.origin}))),t=r.reduce((e,t)=>(e[`${b(t.serverId).mcpRequest.serverName}_${t.tool.name}`]=p({description:t.tool.description,inputSchema:d(t.tool.inputSchema),execute:async(e,r)=>y(t.id,e)}),e),{}),pm.logger.info(`[LLMClient] Prepared ${Object.keys(t).length} tools for execution:`,Object.keys(t))):pm.logger.info(`[LLMClient] No enabled tools found for origin ${e}`),t}function S(e){if(!e)return;let t=e.promptTokens||e.inputTokens,r=e.completionTokens||e.outputTokens;if(!Number.isNaN(t)&&!Number.isNaN(r))return{promptTokens:t,completionTokens:r}}function R(e){return e?Object.entries(e).map(([e,t])=>({key:e,value:t})):[]}function P(e,t){return{type:e,timestamp:new Date().toISOString(),payload:t}}e.exports=class{constructor(e){this.cwd=e,this.runtimeUtilities=new v(e)}createProvider(e,t){if(!x[e])throw Error(`Unsupported provider: ${e}`);let r=x[e],o=_[e]||{};return pm.logger.info(`[LLMClient~createProvider] Creating provider for: ${e}`),r({apiKey:t.apiKey,...o,fetch:t.customFetch})}async executeStreamRequest({provider:e,model:t,prompt:r,system:o="",origin:s,apiKey:n,settings:i,networkSettings:a,proxyConfig:l={url:void 0,system:!1,env:!1}}){let d={model:this.createProvider(e,{apiKey:n,customFetch:await this.generateCustomFetch({networkSettings:a,proxyConfig:l})})(t),prompt:r,system:o,tools:k(s),stopWhen:h(i.maxSteps),...i};pm.logger.info("[LLMClient~executeRequest] Tools:",d.tools);let p=performance.now(),m=new C,g=new AbortController;return m.on("cancel",()=>{let e={text:"Request cancelled by user",request:{responseTime:performance.now()-p,code:499}};pm.logger.error("[LLMClient~executeStreamRequest] User cancelled the request during streamText"),m.emit("error",P("response-error",e)),g.abort(),m.destroy()}),(async()=>{try{let e=c(d);for await(let t of e.fullStream)switch(t.type){case"finish":m.emit("response-stream",P("response-stream",{...t,usage:S(t.totalUsage)}));break;case"finish-step":m.emit("response-stream",P("response-stream",{...t,usage:S(t.usage)}));break;case"start-step":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"tool-call":case"tool-result":case"tool-error":default:m.emit("response-stream",P("response-stream",t));break;case"error":let e={text:t.error&&"object"==typeof t.error&&"message"in t.error&&"string"==typeof t.error.message?t.error.message:"An error occurred during streaming",response:{responseTime:performance.now()-p,statusCode:t.error&&"object"==typeof t.error&&"statusCode"in t.error?t.error.statusCode:void 0,headers:t.error&&"object"==typeof t.error&&"responseHeaders"in t.error?R(t.error.responseHeaders):void 0}};pm.logger.error(`[LLMClient~executeStreamRequest] Error packet found during streamText: ${e.text}`),m.emit("response-error",P("response-error",e)),m.destroy()}let t=(await e.steps).map(e=>({finishReason:e.finishReason,text:e.text,usage:S(e.usage),toolCalls:e.toolCalls&&e.toolCalls.length>0?e.toolCalls.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,args:JSON.stringify(e.input,null,2)})):void 0,toolResults:e.toolResults&&e.toolResults.length>0?e.toolResults.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,result:JSON.stringify(e.output,null,2)})):void 0,response:{responseTime:performance.now()-p,statusCode:200,headers:R(e.response.headers)}}));pm.logger.info("[LLMClient~executeStreamRequest] Response completed generation from streamText"),m.emit("response-received",P("response-received",t)),m.destroy()}catch(s){let e,t,r=s.message;u.isInstance(s)&&(e=s.statusCode,t=R(s.responseHeaders));let o={finishReason:"error",text:r||"Request was unable to stream text",response:{responseTime:performance.now()-p,statusCode:e,headers:t}};pm.logger.error(`[LLMClient~executeStreamRequest] Error executing streamText: ${r}`),m.emit("error",P("response-error",o)),m.destroy()}})(),pm.logger.info("[LLMClient~executeStreamRequest] Event channel created for streaming response"),m}async executeRequest({provider:e,model:t,prompt:r,system:o="",origin:s,apiKey:n,settings:i,networkSettings:a,proxyConfig:c={url:void 0,system:!1,env:!1}}){let d={model:this.createProvider(e,{apiKey:n,customFetch:await this.generateCustomFetch({networkSettings:a,proxyConfig:c})})(t),prompt:r,tools:k(s),system:o,stopWhen:h(i.maxSteps),...i};pm.logger.info("[LLMClient~executeRequest] Tools:",d.tools);let p=performance.now();try{let e=await l(d);pm.logger.info("[LLMClient~executeRequest] Result from generateText:",e);let t=e.steps.map(e=>{var t,r;return{finishReason:e.finishReason,text:e.text,usage:S(e.usage),toolCalls:e.toolCalls&&e.toolCalls.length>0?e.toolCalls.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,args:JSON.stringify(e.input,null,2)})):void 0,toolResults:e.toolResults&&e.toolResults.length>0?e.toolResults.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,result:JSON.stringify(e.output,null,2)})):void 0,reasoning:e.reasoningText,response:{responseTime:performance.now()-p,statusCode:200,headers:R(e.response.headers),body:JSON.stringify(e.response.body),size:(t=e.response.headers,{body:(r=JSON.stringify(e.response.body))?Buffer.byteLength(r,"utf8"):void 0,headers:t?Object.entries(t).reduce((e,[t,r])=>e+Buffer.byteLength(`${t}: ${r}\r
`,"utf8"),0):void 0})}}});return pm.logger.info("[LLMClient~executeRequest] Response generated from generateText"),P("response-received",t)}catch(s){let e,t,r=s.message;u.isInstance(s)&&(e=s.statusCode,t=R(s.responseHeaders));let o={text:r||"Request was unable to generate text",response:{responseTime:performance.now()-p,statusCode:e,headers:t}};return pm.logger.error(`[LLMClient~executeRequest] Error executing generateText: ${r}`),P("response-error",o)}}async executeDryRun({provider:e,model:t,prompt:r,system:o="",origin:s,apiKey:n,settings:i={},streamResponse:a}){let u=async(e,t)=>new Response(JSON.stringify({url:e,method:t.method,headers:t.headers,body:t.body,timeout:t.timeout}),{status:400,headers:{"Content-Type":"application/json"}}),d={model:this.createProvider(e,{apiKey:n,customFetch:u})(t),prompt:r,system:o,tools:k(s),...i};try{if(a){for await(let e of c(d).fullStream)if("error"===e.type){let t=Error("Dry run request failed successfully.");throw t.responseBody=e.error.responseBody,t}return P("request-config-error",{})}return await l(d),P("request-config-error",{})}catch(e){return P("request-config-success",e.responseBody)}}validateUrl(e){/^[a-z0-9+.-]+:\/\//i.test(e)||(e="http://"+e);try{return new URL(e)}catch(t){throw Error(`Invalid URL: ${e}`)}}async generateAgent(e,t){let r,o,s,n;try{r=e.certificates?await this.runtimeUtilities.loadSecureContext(e.certificates):{}}catch(e){return pm.logger.error(`[LLMClient] Unable to load certificates: ${e.message}`),[e,null]}try{let r=this.validateUrl(e.url);o=t.env?this.runtimeUtilities.loadEnvProxy(r):void 0,s=t.system?await this.runtimeUtilities.loadSystemProxy(e.url):void 0,n=t.url??s??o}catch(e){return pm.logger.error(`[LLMClient] Unable to load proxy configuration: ${e.message}`),[e,null]}let i=m.createSecureContext({key:r.key??void 0,cert:r.cert??void 0,pfx:r.pfx??void 0,passphrase:r.passphrase??void 0});r.ca&&i.context.addCACert(r.ca);let a={secureContext:i,rejectUnauthorized:!!e.strictSSL};return n?[null,new f({uri:n,requestTls:a,bodyTimeout:e.requestTimeout})]:[null,new g({connect:a,bodyTimeout:e.requestTimeout})]}async generateCustomFetch({networkSettings:e,proxyConfig:t}){let[r,o]=await this.generateAgent(e,t);if(r)throw pm.logger.error(`[LLMClient] Unable to generate agent: ${r.message}`),r;return async(t,r)=>fetch(t,{...r,headers:{...r.headers,...e.includeImplicitCacheControlHeader?{"Cache-Control":"no-cache"}:{}},dispatcher:o})}}},"./common/services/MCPClient.js":function(e,t,r){let o,{Client:s}=r("./node_modules/@modelcontextprotocol/sdk/dist/cjs/client/index.js"),{SSEClientTransport:n}=r("./node_modules/@modelcontextprotocol/sdk/dist/cjs/client/sse.js"),{StdioClientTransport:i,getDefaultEnvironment:a}=r("./node_modules/@modelcontextprotocol/sdk/dist/cjs/client/stdio.js"),{StreamableHTTPClientTransport:l}=r("./node_modules/@modelcontextprotocol/sdk/dist/cjs/client/streamableHttp.js"),{createMiddleware:c,applyMiddlewares:u}=r("./node_modules/@modelcontextprotocol/sdk/dist/cjs/client/middleware.js"),{Agent:d,ProxyAgent:p}=r("./node_modules/undici/index.js"),{authorizeRequest:h}=r("./node_modules/postman-runtime/lib/authorizer/index.js"),m=r("./node_modules/postman-collection/index.js"),g=r("./node_modules/lodash/lodash.js"),f=r("tls"),y=r("./node_modules/strip-json-comments/index.js"),b=r("./common/channels/EventChannel.js"),w=r("./common/services/RuntimeClientUtilities.js"),{buildRequest:C,buildResponse:v,addToHistory:x,createHistory:_,getLocationHeader:k,resolveLocation:S}=r("./common/utils/requestLogging.js"),{v4:R}=r("./node_modules/uuid/index.js");(async()=>{o=(await r.e("vendors-node_modules_shell-env_index_js").then(r.bind(r,"./node_modules/shell-env/index.js"))).shellEnv})();let{CancelledNotificationSchema:P,LoggingMessageNotificationSchema:T,ResourceUpdatedNotificationSchema:M,ResourceListChangedNotificationSchema:j,ToolListChangedNotificationSchema:E,PromptListChangedNotificationSchema:$,JSONRPCMessageSchema:q,ElicitRequestSchema:A}=r("./node_modules/@modelcontextprotocol/sdk/dist/cjs/types.js"),I=[P,T,M,j,E,$];class O extends i{constructor(e,t){super({...e,stderr:"pipe"}),this.eventChannel=t,this._readBuffer=new H(t),this._errorReadBuffer=new J(t)}async close(){pm.logger.info("CustomStdioClientTransport~close: closing stdio process"),this._process.kill("SIGKILL"),await super.close()}send(e){return U(this.eventChannel,"sent-data",{method:e.method??"unknown",data:e}),super.send(e)}async start(){await super.start(),this._process.stderr?.on("data",e=>{this._errorReadBuffer.readMessage(e)})}}class L extends l{constructor(e,t,r){super(e,t),this.eventChannel=r}send(e,t){return U(this.eventChannel,"sent-data",{method:e.method??"unknown",data:e}),super.send(e,t)}}class F extends n{constructor(e,t,r){super(e,t),this.eventChannel=r}send(e){return U(this.eventChannel,"sent-data",{method:e.method??"unknown",data:e}),super.send(e)}}function U(e,t,r){!e||e.isDestroyed()||e.emit(t,{type:t,timestamp:new Date().toISOString(),payload:r})}let D=new Set(["noauth","basic","bearer","oauth2"]);async function N(e,t,r){if(!t)return null;if(!t.type||!t[t.type]&&"noauth"!==t.type)throw Error("Invalid auth format");if(!D.has(t.type))throw Error(`Unsupported authorization type: ${t.type}`);return new Promise((o,s)=>{h(new m.Request({url:e,auth:t,method:"POST",body:{mode:"raw",raw:JSON.stringify(r)}}),(e,t)=>{e?s(e):o(g.fromPairs(t.headers.toJSON().map(e=>[e.key,e.value])))})})}function z(e,t,r){e.forEach(e=>{t.setNotificationHandler(e,r)})}class B{constructor(e){this.eventChannel=e}append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}clear(){this._buffer=void 0}readMessage(e){}}class H extends B{_buffer;readMessage(){let e;if(!this._buffer)return null;let t=this._buffer.indexOf("\n");if(-1===t)return null;try{var r;return e=this._buffer.toString("utf8",0,t).replace(/\r$/,""),this._buffer=this._buffer.subarray(t+1),r=e,q.parse(JSON.parse(r))}catch{U(this.eventChannel,"logs",{data:e,level:"info"})}}}class J extends B{readMessage(e){if(!e)return null;let t=e.toString("utf8").replace(/\r$/,"");return U(this.eventChannel,"logs",{data:t.trim(),level:"error"}),t}}let W=e=>c(async(t,r,o)=>{let s=R(),n=_(s),i=C(o,r.href??r),a=performance.now(),l=await t(r,{...o,redirect:"manual"}),c=performance.now(),u=0;for(;l.status>=300&&l.status<400&&u<4;){let e=k(l.headers);if(!e)break;let d=l.clone();x(n,i,v(d,void 0),s),i=C(o,S(e,r)),a=performance.now(),l=await t(new URL(e),{...o,redirect:"manual"}),c=performance.now(),u++}let d=l.clone();return d.body.pipeThrough(new TextDecoderStream).getReader().read().then(({value:t})=>{let r=v(d,c-a,t);x(n,i,r,s),U(e,"http:request",{request:i,response:r,history:n})}).catch(e=>{e?.name!=="AbortError"&&pm.logger.error(`MCPClient~loggingMiddleware: had an error while reading the response: ${e}`)}),l});e.exports=class{constructor(e){this._PATH=null,this.cwd=e,this.runtimeUtilities=new w(e),this.requestIdToClientMap=new Map,this.requestIdToAbortControllerMap=new Map}async connect(e,t=!0){let r=new b,o=new AbortController;return this.requestIdToAbortControllerMap.set(e.requestId,o),r.on("cancel",async({forceClose:t=!1})=>{o.abort(),this.requestIdToAbortControllerMap.delete(e.requestId),t&&(U(r,"aborted",{message:"Connection aborted"}),await this.disconnect(e.requestId),r.destroy())}),this.startConnection(e,t,r).then(t=>{pm.logger.info("MCPClient~connect: Getting tools"),this.getTools(e.requestId).then(([e,t])=>{e?pm.logger.error(`MCPClient~connect: Error getting tools: ${e.message}`):(pm.logger.info("MCPClient~connect: Successfully fetched tools"),U(r,"get-tools",t))}),pm.logger.info("MCPClient~connect: Getting resources"),this.getResources(t).then(([e,t])=>{e?pm.logger.error(`MCPClient~connect: Error getting resources: ${e.message}`):(pm.logger.info("MCPClient~connect: Successfully fetched resources"),U(r,"get-resources",t))}),pm.logger.info("MCPClient~connect: Getting prompts"),this.getPrompts(t).then(([e,t])=>{e?pm.logger.error(`MCPClient~connect: Error getting prompts: ${e.message}`):(pm.logger.info("MCPClient~connect: Successfully fetched prompts"),U(r,"get-prompts",t))}),pm.logger.info("MCPClient~connect: Getting resource templates"),this.getResourceTemplates(t).then(([e,t])=>{e?pm.logger.error(`MCPClient~connect: Error getting resource templates: ${e.message}`):(pm.logger.info("MCPClient~connect: Successfully fetched resource templates"),U(r,"get-resource-templates",t))})}).catch(()=>{}),r}async startConnection(e,t=!0,r,o=null){let{requestId:s,transport:n,settings:i}=e,{requestTimeout:a}=i??{},l=this.requestIdToAbortControllerMap.get(s)?.signal??o;if(!l||l?.aborted){let e=new AbortController;this.requestIdToAbortControllerMap.set(s,e),l=e.signal}let c="sse"===n?"streamableHTTP":"stdio",u=e=>{U(r,"received-notification",{notification:e})},d=(e,t)=>{let o=this.requestIdToClientMap.get(s)||{},{pendingRequests:n=new Map}=o,{signal:i,requestId:a}=t;return o.pendingRequests||(o.pendingRequests=n),n.set(a,{signal:i}),new Promise((t,o)=>{i?.addEventListener("abort",()=>{n.delete(a),U(r,"request-aborted",{message:`Elicitation request id: ${a} was canceled.`,elicitationRequestId:a})}),r.on("elicitation-response",e=>{let{relatedRequestId:r,result:o}=e;r===a&&(n.delete(a),t(o))}),U(r,"received-data",{method:"elicitation/create",data:{id:a,...e}})})};try{let o,n,i=await this.createOrGetClient(e,t);if("stdio"===c)[n,o]=await this.generateStdioTransport(e,r);else if("streamableHTTP"===c)[n,o]=await this.generateHTTPTransport(e,r,c);else throw Error(`Unsupported transport: ${c}`);if(n)throw n;z(I,i,u),i.setRequestHandler(A,d),pm.logger.info(`MCPClient~connect: Connecting to MCP server with transport: ${c}`);try{await i.connect(o,{...this.runtimeUtilities.createTimeoutOptions(a),signal:l})}catch(n){let s;if(await i.close?.(),l?.aborted)return void U(r,"aborted",{message:"Connection aborted"});if(/http\s+401/i.test(n.message))throw n.code=401,n;if("stdio"===c)throw n;if(c="sse","sse"===c&&([s,o]=await this.generateHTTPTransport(e,r,c)),s||"stdio"===c)throw s;pm.logger.info("MCPClient~connect: Attempting to connect to MCP server with transport: sse"),i=await this.createOrGetClient(e,t),z(I,i,u),i.setRequestHandler(A,d),await i.connect(o,{...this.runtimeUtilities.createTimeoutOptions(a),signal:l})}let p=i.getServerCapabilities();return U(r,"connected",{connectionStatus:"connected",serverCapabilities:p}),pm.logger.info(`MCPClient~connect: Connected to MCP server with transport: ${c}`),this.requestIdToClientMap.set(s,{client:i,eventChannel:r,request:e}),r?.addCleanup(async()=>await this.disconnect(s)),s}catch(e){throw pm.logger.error(`MCPClient~connect: Error connecting to MCP server: ${e.message}`),this.requestIdToClientMap.delete(s),setImmediate(()=>{U(r,"error",{message:`Error connecting to MCP server: ${e.message}`,source:"connect",statusCode:e?.code}),r?.destroy()}),e}}async createOrGetClient(e,t=!1){let{requestId:r}=e;if(this.requestIdToClientMap.has(r))if(!t)return this.requestIdToClientMap.get(r);else{let{client:e}=this.requestIdToClientMap.get(r);e.close&&await e.close(),this.requestIdToClientMap.delete(r)}return new s({name:`Postman Client - ${r}`,version:"1.0.0"},{capabilities:{elicitation:{}}})}async disconnect(e){let{client:t,eventChannel:r}=this.requestIdToClientMap.get(e)??{};t&&await t.close(),this.requestIdToClientMap.delete(e),U(r,"disconnected",{message:"Disconnected from MCP server"}),setTimeout(()=>r?.destroy())}async generateHTTPTransport(e,t,r="streamableHTTP"){let o,s,n,i,a,l,h,{url:m,auth:g,certs:y,settings:b={},requestId:w,headers:k=[],proxy:S={url:void 0,system:!1,env:!1}}=e,P=function(e,t){let r;/^[a-z0-9+.-]+:\/\//i.test(e)||(e=("http"===t?"http:":"ws:")+"//"+e);try{r=new URL(e)}catch(r){let t=Error(`Invalid URL: ${e}`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_URL",enumerable:!0}),t}return r}(m,"http"),T=await N(m,g,{}),M=k.reduce((e,t)=>(t.disabled||(e[t.key]=t.value),e),{}),j={...T,...M};try{o=y?await this.runtimeUtilities.loadSecureContext(y):{}}catch(e){return pm.logger.error(`MCPClient~connectSSE: Unable to load certificates: ${e.message}`),[e,null]}try{s=S.env?this.runtimeUtilities.loadEnvProxy(P):void 0,n=S.system?await this.runtimeUtilities.loadSystemProxy(m):void 0,i=S.url??n??s}catch(e){return pm.logger.error(`MCPClient~connectSSE: Unable to load proxy configuration: ${e.message}`),[e,null]}let E=f.createSecureContext({key:o.key??void 0,cert:o.cert??void 0,pfx:o.pfx??void 0,passphrase:o.passphrase??void 0});o.ca&&E.context.addCACert(o.ca);let $={secureContext:E,rejectUnauthorized:!!b.verifySSLCertificates};i?(a="sse"===r?new p({uri:i,requestTls:$}):void 0,l=new p({uri:i,requestTls:$})):(a="sse"===r?new d({connect:$}):void 0,l=new d({connect:$})),a?.on("disconnect",async()=>{await this.disconnect(w)});let q="streamableHTTP"===r?new L(P,{requestInit:{dispatcher:l,...j&&{headers:j}},fetch:u(W(t))(async(e,t)=>{let r=await fetch(e,t);if(r.status>=300&&r.status<400){let t=r.headers.get("Location");t&&(t.startsWith("/")&&(t=(e.host??e)+t),q._url=t)}return r})},t):new F(P,{eventSourceInit:{fetch:u((h=t,c(async(e,t,r)=>{let o=performance.now(),s=await e(t,r),{signal:n}=r,i=C({...r,method:"POST"},t.href),a=s.clone(),l=a.body.pipeThrough(new TextDecoderStream,{signal:n}).getReader(),c="";return(async()=>{if(l)try{for(;!n?.aborted;){let{value:e,done:t}=await l.read();if(e&&(c+=e),t)break}}catch(e){if("AbortError"===e.name){let e=v(a,performance.now()-o,c),t=R(),r=_(t);x(r,i,e,t),U(h,"http:request",{request:i,response:e,history:r})}}finally{l.releaseLock()}})().catch(()=>{}),s})))((e,t)=>fetch(e,{...t,headers:{...t.headers,...j,Accept:"text/event-stream"},dispatcher:a}))},requestInit:{dispatcher:l,...j&&{headers:j}},fetch:u(W(t))(fetch)},t);return[void 0,q]}async generateStdioTransport(e,t){let{command:r,args:s,env:n=[]}=e,i=n.reduce((e,{key:t,value:r,disabled:o})=>(!o&&(null===r||void 0!==r)&&t&&(e[t]=r),e),{});try{if(!this._PATH&&!i.PATH){let e=await o();this._PATH=process.env.PATH=e.PATH}let e={...a(),...i},n=new O({command:r,args:s,env:e},t);return[void 0,n]}catch(e){return pm.logger.error(`MCPClient~generateStdioTransport: Error generating Stdio transport: ${e.message}`),[e,null]}}getClientFromRequestId(e,t){let{client:r}=this.requestIdToClientMap.get(e)??{};if(!r){let r=`No client found for requestId: ${e}`;throw pm.logger.error(`MCPClient~${t}: ${r}`),Error(r)}return r}getRequestSettingsFromRequestId(e,t){let{request:r}=this.requestIdToClientMap.get(e)??{};if(!r){let r=`No request found for requestId: ${e}`;throw pm.logger.error(`MCPClient~${t}: ${r}`),Error(r)}return r.settings||{}}async getTools(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"getTools"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"getTools"),i=await n.listTools(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~getTools: Unable to get tools: ${e.message}`),[e,void 0]}}async callTool(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"callTool"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"callTool"),i=await n.callTool(t,void 0,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~callTool: Unable to call tool: ${e.message}`),[e,void 0]}}async getResources(e,t,r){try{let{requestTimeout:r}=this.getRequestSettingsFromRequestId(e,"getResources"),o={...this.runtimeUtilities.createTimeoutOptions(r)},s=this.getClientFromRequestId(e,"getResources"),n=await s.listResources(t,o);return[void 0,n]}catch(e){return pm.logger.error(`MCPClient~getResources: Unable to get resources: ${e.message}`),[e,[]]}}async getResourceTemplates(e,t,r){try{let{requestTimeout:r}=this.getRequestSettingsFromRequestId(e,"getResourceTemplates"),o=this.runtimeUtilities.createTimeoutOptions(r),s=this.getClientFromRequestId(e,"getResourceTemplates"),n=await s.listResourceTemplates(t,o);return[void 0,n]}catch(e){return pm.logger.error(`MCPClient~getResourceTemplates: Unable to get resource templates: ${e.message}`),[e,void 0]}}async readResource(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"readResource"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"readResource"),i=await n.readResource(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~readResource: Unable to read resource: ${e.message}`),[e,void 0]}}async subscribeToResource(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"subscribeToResource"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"subscribeToResource"),i=await n.subscribeResource(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~subscribeToResource: Unable to subscribe to resource: ${e.message}`),[e,void 0]}}async unsubscribeFromResource(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"unsubscribeFromResource"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"unsubscribeFromResource"),i=await n.unsubscribeResource(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~unsubscribeFromResource: Unable to unsubscribe from resource: ${e.message}`),[e,void 0]}}async getPrompts(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"getPrompts"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"getPrompts"),i=await n.listPrompts(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~getPrompts: Unable to get prompts: ${e.message}`),[e,void 0]}}async getPrompt(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"getPrompt"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"getPrompt"),i=await n.getPrompt(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~getPrompt: Unable to get prompt: ${e.message}`),[e,void 0]}}async requestCompletionOptions(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"requestCompletionOptions"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"requestCompletionOptions"),i=await n.complete(t,s);return[void 0,i]}catch(e){return pm.logger.error(`MCPClient~requestCompletionOptions: Unable to request completion options: ${e.message}`),[e,void 0]}}async setLoggingLevel(e,t,r){try{let{requestTimeout:o}=this.getRequestSettingsFromRequestId(e,"setLoggingLevel"),s={...this.runtimeUtilities.createTimeoutOptions(o),signal:r},n=this.getClientFromRequestId(e,"setLoggingLevel"),{level:i}=t,a=await n.setLoggingLevel(i,s);return[void 0,a]}catch(e){return pm.logger.error(`MCPClient~setLoggingLevel: Unable to set log level: ${e.message}`),[e,void 0]}}async ping(e,t){try{let r=this.getClientFromRequestId(e,"ping"),o=await r.ping({signal:t});return[void 0,o]}catch(e){return pm.logger.error(`MCPClient~ping: Unable to ping: ${e.message}`),[e,void 0]}}async getCapabilities(e){let{client:t,eventChannel:r}=this.requestIdToClientMap.get(e)??{};if(!t){let t=`No client found for requestId: ${e}`;return pm.logger.error(`MCPClient~ping: ${t}`),U(r,"error",{message:t})}let[[o,s],[n,i],[a,l],[c,u]]=await Promise.all([this.getTools(e),this.getResources(e),this.getResourceTemplates(e),this.getPrompts(e)]);return{tools:s,resources:i,resourceTemplates:l,prompts:u,errors:{...o?{tools:o}:{},...n?{resources:n}:{},...a?{resourceTemplates:a}:{},...c?{prompts:c}:{}}}}async sendMessage({requestId:e,message:t}){let r,o,s,n,{eventChannel:i}=this.requestIdToClientMap.get(e),a=this.requestIdToAbortControllerMap.get(e)?.signal;if(!i||i?.isDestroyed()){let t=`No client or channel found for requestId: ${e}`;return pm.logger.error(t),i&&!i?.isDestroyed()?U(i,"error",{payload:{message:t,source:"message"}}):{type:"error",timestamp:new Date().toISOString(),payload:{message:t,source:"message"}}}if(a?.aborted){let t=new AbortController;this.requestIdToAbortControllerMap.set(e,t),a=t.signal}try{r="string"==typeof t&&t.length>0?JSON.parse(y(t)):JSON.parse(y(JSON.stringify(t)))??{}}catch(e){return U(i,"error",{message:`Error parsing message: ${e.message}`,source:"message"})}let{method:l,params:c}=r??{};if(!l)return U(i,"error",{message:`Invalid message: ${t}`,source:"message"});let u=performance.now();switch(l){case"capabilities/refresh":s=await this.getCapabilities(e);break;case"tools/list":[o,s]=await this.getTools(e,c,a);break;case"tools/call":[o,s]=await this.callTool(e,c,a),s&&(n=c.name);break;case"resources/list":[o,s]=await this.getResources(e,c,a);break;case"resources/templates/list":[o,s]=await this.getResourceTemplates(e,c,a);break;case"resources/read":[o,s]=await this.readResource(e,c,a);break;case"resources/subscribe":[o,s]=await this.subscribeToResource(e,c,a);break;case"resources/unsubscribe":[o,s]=await this.unsubscribeFromResource(e,c,a);break;case"prompts/list":[o,s]=await this.getPrompts(e,c,a);break;case"prompts/get":[o,s]=await this.getPrompt(e,c,a);break;case"completions/complete":[o,s]=await this.requestCompletionOptions(e,c,a);break;case"logging/setLevel":[o,s]=await this.setLoggingLevel(e,c,a);break;case"ping":[o,s]=await this.ping(e,a);break;default:U(i,"error",{source:"message",message:`Invalid method: ${l}`});return}let d=performance.now();o?U(i,"error",{message:`Error calling method: ${l}. Error: ${o.message}`,source:"message"}):U(i,"received-data",{method:l,data:s,responseTime:d-u,...n&&{toolName:n}})}}},"./common/services/MCPConnectionManager.js":function(e,t,r){let{v4:o}=r("./node_modules/uuid/index.js"),s=r("./common/services/MCPClient.js");class n{constructor(e){this.connections=new Map,this.toolRegistry=new Map,this.mcpClient=new s(e),this.abortControllerMap=new Map,this.heartbeatMap=new Map}async addConnection(e,t,r={autoConnect:!0,getToolsOnConnect:!0}){let{autoConnect:s=!0,getToolsOnConnect:n=!0,id:i}=r,a=i??o(),l=new AbortController,c={id:a,mcpRequest:e,connected:!1,tools:new Map,origin:t,authStatus:void 0};if(this.connections.set(a,c),this.abortControllerMap.set(a,l),s)try{let e=await this.connect(a);e&&n?(await this.fetchToolsForServer(a),pm.logger.info(`MCPConnectionManager~addConnection: Connection ${a} established with tools registered`)):e&&pm.logger.info(`MCPConnectionManager~addConnection: Connection ${a} established without tools`)}catch(e){pm.logger.error("MCPConnectionManager~addConnection: Error when connecting and fetching tools",e),c.connected=!1}return a}async connect(e){let t=this.connections.get(e);if(!t)throw Error(`Connection with id ${e} not found`);pm.logger.info(`MCPConnectionManager~connect: Connecting to server ${e}`);let r={...t.mcpRequest,requestId:e},o=this._getOrCreateAbortSignal(e),s=!1;try{s=await this.mcpClient.startConnection(r,!1,null,o),"needs_auth"===t.authStatus?t.authStatus="auth_success":t.authStatus||(t.authStatus="no_auth")}catch(e){if(401===e.code)t.authStatus="needs_auth";else throw e}return s?(t.connected=!0,this.connections.set(e,t),this.initializeHeartbeat(e),pm.logger.info(`MCPConnectionManager~connect: Successfully connected to server ${e}`)):pm.logger.error(`MCPConnectionManager~connect: Failed to connect to server ${e}`),!!s}async addConnections(e,t,r={}){let o=[],s=e.map(e=>{try{let s=this.addConnection(e,t,r);o.push(s)}catch(e){o.push(e.message||!1)}});return await Promise.all(s),o}async removeConnection(e){let t=this.connections.get(e);return t&&(await this.mcpClient.disconnect(e),t.tools.forEach(e=>{this.toolRegistry.delete(e.id)})),this.clearConnection(e),!0}async disconnect(e){let t=this.connections.get(e);if(!t)throw Error(`Connection with id ${e} not found`);if(!t.connected)return pm.logger.warn(`MCPConnectionManager~disconnect: Connection with id ${e} is not connected`),!0;pm.logger.info(`MCPConnectionManager~disconnect: Disconnecting server ${e}`),await this.mcpClient.disconnect(e),t.connected=!1,this.connections.set(e,t);let r=this.heartbeatMap.get(e);return r&&(clearTimeout(r),this.heartbeatMap.delete(e),pm.logger.info(`MCPConnectionManager~disconnect: Cleared heartbeat for server ${e}`)),this.abortControllerMap.has(e)&&(this.abortControllerMap.delete(e),pm.logger.info(`MCPConnectionManager~disconnect: Cleared abort controller for server ${e}`)),pm.logger.info(`MCPConnectionManager~disconnect: Successfully disconnected server ${e}`),!0}async _heartbeat(e){let t=this.connections.get(e);if(!t||!t.connected)return pm.logger.warn(`MCPConnectionManager~_heartbeat: No active connection found for id ${e}`),!1;let[r,o]=await this.mcpClient.ping(e);return!r&&!!o||(pm.logger.warn(`MCPConnectionManager~_heartbeat: Error during heartbeat for connection ${e}`,r),!1)}initializeHeartbeat(e){let t=this.connections.get(e);if(!t)return pm.logger.error(`MCPConnectionManager~initializeHeartbeat: No connection found for id ${e}`),null;this.heartbeatMap.has(e)&&clearTimeout(this.heartbeatMap.get(e));let r=setTimeout(()=>{this._heartbeat(e).then(o=>{o?this.initializeHeartbeat(e):(pm.logger.warn(`MCPConnectionManager~initializeHeartbeat: Heartbeat failed for connection ${e}, attempting to reconnect`),t.connected=!1,this.connections.set(e,t),clearTimeout(r),this.reconnect(e))}).catch(t=>{pm.logger.error(`MCPConnectionManager~initializeHeartbeat: Error during heartbeat for connection ${e}`,t)})},6e4);return this.heartbeatMap.set(e,r),r}async reconnect(e,t={}){let r=this.connections.get(e);r||pm.logger.warn(`MCPConnectionManager~reconnect: No connection found for id ${e}`);let{retryCount:o=3}=t;for(let t=0;t<o;t++)try{if(pm.logger.info(`MCPConnectionManager~reconnect: Attempt ${t+1} to reconnect to connection ${e}`),await this.connect(e))return pm.logger.info(`MCPConnectionManager~reconnect: Successfully reconnected to connection ${e}`),r.connected=!0,this.connections.set(e,r),this.initializeHeartbeat(e),!0}catch(t){pm.logger.error(`MCPConnectionManager~reconnect: Error reconnecting to connection ${e}`,t)}return!1}getConnection(e){return this.connections.get(e)}hasConnection(e){return this.connections.has(e)}clearConnection(e){let t=this.connections.get(e);t&&t.tools.forEach(e=>this.toolRegistry.delete(e.id)),this.connections.delete(e),this.abortControllerMap.delete(e);let r=this.heartbeatMap.get(e);r&&(clearTimeout(r),this.heartbeatMap.delete(e))}clearAllConnections(){this.connections.clear(),this.toolRegistry.clear(),this.abortControllerMap.clear(),this.heartbeatMap.forEach(e=>clearTimeout(e)),this.heartbeatMap.clear(),pm.logger.info("MCPConnectionManager~clearAllConnections: Cleared all connections and abort")}async callTool(e,t){let r=this.toolRegistry.get(e);if(!r||!r.enabled)throw pm.logger.error(`MCPConnectionManager~callTool: Tool with id ${e} is not enabled`),Error(`Tool with id ${e} is not enabled`);let o={name:r.tool.name,arguments:t},s=this._getOrCreateAbortSignal(r.serverId),[n,i]=await this.mcpClient.callTool(r.serverId,o,s);if(n)throw pm.logger.error(`MCPConnectionManager~callTool: Error calling tool with id ${e}`,n),Error(`Error calling tool with id ${e}: ${n.message}`);return i}async fetchToolsForServer(e){if(!this.hasConnection(e))return pm.logger.error(`MCPConnectionManager~fetchToolsForServer: No connection found for id ${e}`),Promise.reject(Error(`No connection found for id ${e}`));if(!this.getConnection(e).connected)try{await this.connect(e)}catch(t){return pm.logger.error(`MCPConnectionManager~fetchToolsForServer: Error connecting to server with id ${e}`,t),Promise.reject(Error(`Error connecting to server with id ${e}: ${t.message}`))}let[t,{tools:r}]=await this.mcpClient.getTools(e);return t?(pm.logger.error(`MCPConnectionManager~fetchToolsForServer: Error fetching tools for server with id ${e}`,t),Promise.reject(Error(`Error fetching tools for server with id ${e}: ${t.message}`))):(this.registerTools(e,r),Promise.resolve(r||[]))}async refetchToolsForServer(e){let t=this.connections.get(e);if(!t)throw Error(`Connection with id ${e} not found`);let[r,{tools:o}]=await this.mcpClient.getTools(e);if(r)throw pm.logger.error(`MCPConnectionManager~refetchToolsForServer: Error refetching tools for server with id ${e}`,r),Error(`Error refetching tools for server with id ${e}: ${r.message}`);return t.tools.forEach(e=>this.toolRegistry.delete(e.id)),t.tools.clear(),pm.logger.info(`[MCPConnectionManager] Cleared existing tools for server ${e} after successful refetch.`),this.registerTools(e,o),o||[]}registerTools(e,t){let r=this.connections.get(e);if(!r)throw Error(`Connection with id ${e} not found`);for(let o of(pm.logger.info(`[MCPConnectionManager] Registering ${t.length} tools for server ${e} with origin ${r.origin}`),t)){let t=`${e}-${o.name}`,s={id:t,serverId:e,origin:r.origin,tool:o,enabled:!0};this.toolRegistry.set(t,s),r.tools.set(t,s)}pm.logger.info(`[MCPConnectionManager] Successfully registered ${t.length} tools for server ${e}`)}enableTool(e){let t=this.toolRegistry.get(e);if(!t)return pm.logger.error(`MCPConnectionManager~enableTool: Tool with id ${e} not found`),null;t.enabled=!0;let r=this.connections.get(t.serverId);if(r&&r.tools.has(e)){let t=r.tools.get(e);t&&(t.enabled=!0)}return t}disableTool(e){let t=this.toolRegistry.get(e);if(!t)return pm.logger.error(`MCPConnectionManager~disableTool: Tool with id ${e} not found`),null;t.enabled=!1;let r=this.connections.get(t.serverId);if(r&&r.tools.has(e)){let t=r.tools.get(e);t&&(t.enabled=!1)}return t}toggleTool(e,t){return t?this.enableTool(e):this.disableTool(e)}_getOrCreateAbortSignal(e){let t=this.abortControllerMap.get(e)?.signal;if(!t||t.aborted){let r=new AbortController;this.abortControllerMap.set(e,r),t=r.signal}return t}}let i=new n;e.exports={connectToMCP:async function e(t,r,o={autoConnect:!0,getToolsOnConnect:!0}){let s=await i.addConnection(t,r,o);return i.getConnection(s)},toggleTool:function(e,t){return i.toggleTool(e,t)},callTool:async function e(e,t){return await i.callTool(e,t)},bulkConnectToMCP:async function e(t,r,o={autoConnect:!0,getToolsOnConnect:!0}){return(await i.addConnections(t,r,o)).map(e=>"string"==typeof e?i.getConnection(e):e)},getToolsForServer:function(e,t=!1){let{toolRegistry:r,connections:o}=i;return Array.from(r.values()).filter(r=>r.serverId===e&&(!t||r.enabled&&o.get(r.serverId)?.connected))},getToolsByOrigin:function(e,t=!1){let{toolRegistry:r,connections:o}=i;return Array.from(r.values()).filter(r=>r.origin===e&&(!t||r.enabled&&o.get(r.serverId)?.connected))},disconnectFromMCP:async function e(t,r=!1){let o=await i.disconnect(t);return o&&r&&await i.removeConnection(t),o},getServerById:function(e){let t=i.getConnection(e);return t||(pm.logger.error(`MCPConnectionManager~getServerById: No connection found for id ${e}`),null)},getServersByOrigin:function(e){return Array.from(i.connections.values()).filter(t=>t.origin===e)},MCPConnectionManager:n,cancelMCPRequest:function(e){this._getOrCreateAbortSignal(e).abort()},refetchToolsForServer:async function e(e){return await i.refetchToolsForServer(e)}}},"./common/services/MQTTClient.js":function(e,t,r){let o=r("./node_modules/mqtt/mqtt.js"),s=r("./node_modules/file-type/index.js"),n=r("./common/channels/EventChannel.js"),{EventEmitter:i}=r("events"),a=r("./common/utils/postmanFs.js"),{promisify:l}=r("util"),c=r("./node_modules/postman-ws/index.js"),u=r("net"),d=r("tls"),p=r("./node_modules/strip-json-comments/index.js"),h=r("./node_modules/lodash/lodash.js");function m(e,t,r){e.emit(t,{type:t,timestamp:new Date().toISOString(),payload:r})}async function g(e,{cwd:t}){let[r,o,s,n]=await Promise.all([e.ca?f(e.ca,{cwd:t}):void 0,e.cert?f(e.cert,{cwd:t}):void 0,e.key?f(e.key,{cwd:t}):void 0,e.pfx?f(e.pfx,{cwd:t}):void 0]);return{ca:r,cert:o,key:s,pfx:n,passphrase:e.passphrase}}async function f(e,{cwd:t}){let r=new a(t),o=l(r.readFile.bind(r));return await o(e)}async function y(e){let t,{payload:r,properties:o}=e;if(o){let{payloadFormatIndicator:e}=o;if(!0===e)return"text/plain"}let n=r;if(r instanceof ArrayBuffer||Buffer.isBuffer(r))try{var i;let e=await s.fromBuffer(r);if(t=e?.mime)return t;if(i=r,"string"==typeof i?/[\u0000-\u0009\u000B-\u000C\u000E-\u001F\u007F-\u009F\uFFFD]/.test(i):new Uint8Array(i).some(e=>10!==e&&13!==e&&(e<32||e>126)))return"application/octet-stream";n=r.toString("utf8")}catch(e){throw Error(`Unable to detect content type: ${e}`)}return!function(e){var t;let r;try{r=JSON.parse(e)}catch(e){return!1}return!!(null!==(t=r)&&"object"==typeof t&&!Array.isArray(t))}(n)?"text/plain":"application/json"}function b(e,t){switch(t){case"connack":let r=new Set(["cmd","returnCode","reasonCode","sessionPresent","properties","length"]);return h.pickBy(e,(e,t)=>null!=e&&r.has(t));case"suback":let o=new Set(["cmd","messageId","granted","properties","length"]);return h.pickBy(e,(e,t)=>null!=e&&o.has(t));case"unsuback":let s=new Set(["cmd","messageId","properties","length"]);return h.pickBy(e,(e,t)=>null!=e&&s.has(t));case"puback":case"pubrec":case"pubrel":case"pubcomp":let n=new Set(["cmd","messageId","reasonCode","properties","length"]);return h.pickBy(e,(e,t)=>null!=e&&n.has(t));case"publish":let i=new Set(["cmd","topic","payload","qos","retain","dup","length","properties","messageId"]);return h.pickBy(e,(e,t)=>null!=e&&i.has(t));case"disconnect":let a=new Set(["cmd","reasonCode","properties"]);return h.pickBy(e,(e,t)=>null!=e&&a.has(t));default:return h.pickBy(e,e=>null!=e)}}e.exports=class{constructor(e){this.cwd=e}async request({request:e,protocol:t,isSecure:r}){let s=new n,{url:a,options:l,auth:f,certs:w}=e;if(l.protocolId="MQTT",l.protocolVersion=l.version,!1===l.autoReconnect?l.reconnectPeriod=0:l.reconnectPeriod=1e3,"basic"===f.type&&f.basic&&f.basic.forEach(e=>{"username"===e.key?l.username=e.value:l.password=e.value}),l.will&&"json"===l.will.type){let e=`${l.will.message}`;l.will.message=p(e)}let C=w?await g(w,{cwd:this.cwd}):{};try{let e;s.on("subscribe",t=>{try{!function({topics:e,options:t},r){if(!r||!r.connected)throw Error("MQTT client is not connected.");r.subscribe(e,t)}(t,e)}catch(e){pm.logger.error(`Error in MQTT Client: ${e.message}`),m(s,"error",{error:`Unable to subscribe to topic - ${t.topics}: ${e.message}`}),s.destroy()}}).on("unsubscribe",t=>{try{!function({topic:e,options:t},r){if(!r||!r.connected)throw Error("MQTT client is not connected.");r.unsubscribe(e,t,e=>{if(e)throw e})}(t,e)}catch(e){pm.logger.error(`Error in MQTT Client: ${e.message}`),m(s,"error",{error:`Unable to unsubscribe from topic - ${t.topic}: ${e.message}`}),s.destroy()}}).on("publish",t=>{try{!function({topic:e,message:t,options:r,type:o},s){if(!s||!s.connected)throw Error("MQTT client is not connected.");"json"===o&&(t=p(`${t}`)),h.isEmpty(r.properties.userProperties)&&delete r.properties.userProperties,s.publish(e,t,r,e=>{if(e)throw e})}(t,e)}catch(e){pm.logger.error(`Error in MQTT Client: ${e.message}`),m(s,"error",{error:`Unable to publish message: ${e.message}`}),s.destroy()}}).on("disconnect",t=>{try{!function({force:e,options:t},r){if(!r||!r.connected)throw Error("MQTT client is not connected.");r.end(e,t)}(t,e)}catch(e){pm.logger.error(`Error in MQTT Client: ${e.message}`),s.destroy()}}).on("error",()=>{s.destroy()}).addCleanup(()=>e&&e.end(!0)),e=o.Client(()=>(function({protocol:e,url:t,options:r,certificate:o,isSecure:s,channel:n}){let a,{hostname:l="localhost",port:p}=new URL(t),h=p||1883,g=s?o:null,{rejectUnauthorized:f=!1}=r;try{if("mqtt"===e&&s)a=d.connect({port:h,host:l,rejectUnauthorized:f,...g});else if("mqtt"===e)a=u.createConnection({port:h,host:l});else if("ws"===e){var y,b;let e=new i;e.on("error",(e,t)=>{m(n,"error",{error:`An error occurred: ${t.message||"An unknown error occurred"}`})});let r=new(y={rejectUnauthorized:f,...g},b=e,class extends c{constructor(e){super(e,["mqtt"],y),b&&(this.on("open",(...e)=>b.emit("open",this,...e)),this.on("close",(...e)=>b.emit("close",this,...e)),this.on("error",(...e)=>b.emit("error",this,...e)))}getHandshakeRequest(){return this._debug?this._debug[0].request:void 0}getHandshakeResponse(){return this._debug?this._debug[this._debug.length-1].response:void 0}})(t);a=c.createWebSocketStream(r)}return a.on("error",e=>{m(n,"error",{error:`An error occurred: ${e.message||e.code}`})}),a}catch(e){setImmediate(()=>m(n,"error",{error:`An error occurred: ${e.message}`}))}})({protocol:t,url:a,options:l,certificate:C,isSecure:r,channel:s}),l);let n=!1,g=new Map,f=!1;return e.on("connect",t=>{let r=b(t,t.cmd);m(s,"connected",{packet:r,connected:e.connected,url:a})}).on("error",t=>{!0!==n&&(m(s,"error",{error:`An error occurred: ${t.message}`}),e.end())}).on("close",()=>{!1===f&&m(s,"disconnected",{message:"Connection closed."}),s.destroy()}).on("reconnect",()=>{m(s,"reconnecting",{message:"Reconnecting to the broker."})}).on("packetreceive",async t=>{let r=b(t,t.cmd),o={packet:r};switch(r.cmd){case"suback":g.has(r.messageId)&&g.get(r.messageId).forEach((e,t)=>{r.granted[t]={topic:e.topic,qos:r.granted[t]}});break;case"unsuback":g.has(r.messageId)&&g.get(r.messageId).forEach(e=>{r.granted=[{topic:e}]});break;case"connack":if(r.reasonCode>0&&r.reasonCode<=5&&!r.returnCode&&(r.returnCode=r.reasonCode,delete r.reasonCode),0===r.returnCode||0===r.reasonCode)return;n=!0;let{connected:i}=e;m(s,"connected",{packet:r,connected:i,url:a});return;case"disconnect":r.reasonCode>25&&(n=!0),m(s,"disconnected",{packet:r,message:0===r.reasonCode||4===r.reasonCode?"Disconnected from broker.":void 0}),f=!0;return;case"publish":o.contentType=await y(r).then(e=>e).catch(e=>{m(s,"error",{error:`Unable to detect content type: ${e}`})});break;case"puback":case"pubrel":case"pubrec":case"pubcomp":case"pingreq":case"pingresp":case"auth":return}m(s,"incoming-packet",o)}).on("packetsend",e=>{switch(e.cmd){case"connect":m(s,"connect",{packet:e});break;case"publish":m(s,"outgoing-packet",{packet:e});case"puback":case"pubrel":case"pubcomp":case"pubrec":case"pingreq":case"pingresp":case"auth":break;case"subscribe":g.set(e.messageId,e.subscriptions);break;case"unsubscribe":g.set(e.messageId,e.unsubscriptions)}}),s}catch(e){pm.logger.error(`Error in MQTT Client: ${e.message}`),setImmediate(()=>m(s,"error",{error:`Error: ${e.message}`}))}}}},"./common/services/RuntimeClientUtilities.js":function(e,t,r){let{promisify:o}=r("util"),s=r("./common/utils/postmanFs.js"),n=r("./utils/getSystemProxy.js"),i={http_proxy:process.env.http_proxy,https_proxy:process.env.https_proxy,no_proxy:process.env.no_proxy},a={http_proxy:process.env.HTTP_PROXY,https_proxy:process.env.HTTPS_PROXY,no_proxy:process.env.NO_PROXY};e.exports=class{constructor(e){this.defaultWorkingDir=e}async loadFile(e,{cwd:t,encoding:r}={cwd:void 0,encoding:void 0}){let n=new s(t||this.defaultWorkingDir),i=await o(n.readFile.bind(n))(e);return r?i.toString(r):i}async loadSecureContext(e,t){let[r,o,s,n]=await Promise.all([e.ca?this.loadFile(e.ca,t):void 0,e.cert?this.loadFile(e.cert,t):void 0,e.key?this.loadFile(e.key,t):void 0,e.pfx?this.loadFile(e.pfx,t):void 0]);return{ca:r,cert:o,key:s,pfx:n,passphrase:e.passphrase}}async loadSystemProxy(e){return new Promise((t,r)=>{n(e,(e,o)=>{if(e)return r(e);t(o?.getProxyUrl())})})}formatHostname(e){return e.replace(/^\.*/,".").toLowerCase()}parseNoProxyZone(e){let t=(e=e.trim().toLowerCase()).split(":",2),r=this.formatHostname(t[0]);return{hostname:r,port:t[1],hasPort:e.indexOf(":")>-1}}uriInNoProxy(e,t){let r=e.port||("https:"===e.protocol?"443":"80"),o=this.formatHostname(e.hostname);return t.split(",").map(e=>this.parseNoProxyZone(e)).some(e=>{let t=o.indexOf(e.hostname),s=t>-1&&t===o.length-e.hostname.length;return e.hasPort?r===e.port&&s:s})}loadEnvProxy(e){let t=a.no_proxy??i.no_proxy??"";return"*"===t||""!==t&&this.uriInNoProxy(e,t)?null:"http:"===e.protocol?a.http_proxy??i.http_proxy??null:"https:"===e.protocol?a.https_proxy??i.https_proxy??null:null}createTimeoutOptions(e){return!e||e<=0?(pm.logger.info("MCPClient: Using large timeout (1000000000ms)"),{resetTimeoutOnProgress:!0,maxTotalTimeout:1e9,timeout:1e9}):(pm.logger.info(`MCPClient: Using timeout of ${e}ms`),{resetTimeoutOnProgress:!0,maxTotalTimeout:e,timeout:e})}}},"./common/services/RuntimeEventProcessor.js":function(e,t,r){let o=r("./node_modules/async/lib/async.js"),s=r("./node_modules/serialised-error/index.js"),n=r("./node_modules/shortid/index.js"),i=()=>{},a=(e,t=new WeakSet)=>{let r=Array.isArray(e)?[]:{};for(let[o,s]of(t.add(e),Object.entries(e)))if("function"!=typeof s){if(!s||"object"!=typeof s){r[o]=s;continue}if(!t.has(e[o])){r[o]=a(e[o],t);continue}r[o]="[Circular]"}return t.delete(e),r},l=e=>a(new s(e));class c{constructor(e,t){this.key=e.key,this.from=e.from||!1,this.to=e.to||!1,e.select?this.select=Object.keys(e.select).map(r=>{if(!1===e.select[r]||null===e.select[r])return!1;let o={};return"object"==typeof e.select[r]&&(o=new c(e.select[r],t)),o._key=r,o}).filter(Boolean):this.select=!1,e.forEach&&"object"==typeof e.forEach?this.forEach=new c(e.forEach,t):this.forEach=!1,this.replace=e.replace||!1,this.stream=e.stream||!1,this.manager=t,this._ref=[]}refs(){return this.select?this.select.reduce((e,t)=>t instanceof c?e.concat(...t.refs()):e,this._ref):this._ref}saveRef(e,t,r){this._ref.push(e),this.manager.saveRef(e,{data:t,options:r})}$replace(e){if(!1===this.replace)return e;if(this.replace.call&&"function"==typeof e)return e();if(this.replace.fn&&"function"==typeof e[this.replace.fn])return e[this.replace.fn]();if(this.replace.set)return((e,t,r)=>{let o=r=>String.prototype.split.call(t,r).filter(Boolean).reduce((e,t)=>null!=e?e[t]:e,e),s=o(/[,[\]]+?/)||o(/[,[\].]+?/);return void 0===s||s===e?r:s})(e,this.replace.set);if(Array.isArray(e)&&this.replace.slice)return e[this.replace.slice.to]=e.slice.apply(e,this.replace.slice.from),e;if(Array.isArray(this.replace.error))return this.replace.error.forEach(t=>{e[t]=e[t]&&l(e[t])}),e;else if(this.replace.stream&&"undefined"!=typeof Buffer){if(!("string"==typeof e||Buffer.isBuffer(e)))return e;let t=this.replace.chunk||0xa00000;if(e.length<=t)return e;let r=n.generate();return this.saveRef(r,e,{chunk:t}),{$ref:r}}else return this.replace.limit?!e.length||e.length<=this.replace.limit?e:this.replace.drop?{___dropped___:!0}:"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?{___truncated___:!0,data:e.subarray(0,this.replace.limit)}:"string"==typeof e?{___truncated___:!0,data:e.substring(0,this.replace.limit)}:{___truncated___:!0}:e||this.replace.default}$select(e){return!1===this.select?e:this.select.reduce((t,r)=>{let o=e[r._key];return"function"==typeof o&&(o=o.bind(e)),null!=o&&r instanceof c&&(o=r.parse(o)),!1!==r.error&&("error"===r.key||"err"===r.key||"error"===r._key||"err"===r._key)&&o&&(o=l(o)),t[r.key||r._key]=o,t},Array.isArray(e)&&"object"!==this.to?[]:{})}$forEach(e){return this.forEach&&Array.isArray(e)?e.reduce((e,t,r)=>(e[r]=this.forEach.parse(t),e),[]):e}parse(e){return[this.$replace.bind(this),this.$select.bind(this),this.$forEach.bind(this)].reduce((e,t)=>t(e),e)}}e.exports=class{constructor(e={},t=i){this.emitter=t,this.emitQueue=o.queue(({event:e,data:r,refs:o},s)=>{t(e,r,o),setTimeout(s,0)}),this.events=new Map([]),Object.keys(e).forEach(t=>{this.events.set(t,new Set([new c(e[t],this)]))}),this.streams=new Map([])}saveRef(e,t){this.streams.set(e,t)}intercept(e,t){this.events.has(e)?this.events.get(e).add(t):this.events.set(e,new Set([t]))}streamPending(e){e.forEach(e=>{let{data:t,options:r}=this.streams.get(e),o=r.chunk||1048576;for(var s=0,n=0;s<t.length;s+=o,n++){let r=t.subarray(s,Math.min(s+o,t.length));this.emitQueue.push({event:"__ref__",data:{id:e,meta:{index:n,offset:s,length:r.length},data:r}})}this.emitQueue.push({event:"__ref__",data:{id:e,meta:{end:!0}}}),this.streams.delete(e)})}call(e,t){this.events.has(e)&&this.events.get(e).forEach(r=>{if(r instanceof c){let o=r.parse(t),s=r.refs();this.emitQueue.push({event:e,data:o,refs:s}),this.streamPending(s)}else"function"==typeof r&&setTimeout(()=>{r(...t)},0)})}handlers(){return[...this.events.keys()].reduce((e,t)=>(e[t]=(...e)=>{this.call(t,e)},e),{})}}},"./common/services/RuntimeExecutionService.js":function(e,t,r){let o=r("./node_modules/lodash/lodash.js"),{isString:s}=r("./utils/utilities.js"),n=r("./node_modules/async/lib/async.js"),i=r("./common/services/RuntimeEventProcessor.js"),a=r("./services/sendAnalytics.js"),{AbortError:l}=r("./common/services/VaultIntegrationService.js"),c={ASCII:"ascii","UTF-8":"utf8","UTF-16LE":"utf16le","ISO-8859-1":"latin1"},u=!1,d,p,h,m,g,f,y,b,w,C,v,x,_,k,S,R,P,T,M,j={},E={},$={};async function q(e,t,r){let s;if(u)return!1;if(!e.isIntegrationManagerInitialized())return t.filter(e=>e.provider&&e.provider.id).forEach(e=>{o.isPlainObject(e)&&(e.value="{{"+e.key+"}}")}),!1;let n=[],i=new Set;if(!(Array.isArray(t)&&t.length))return!1;for(let r of t)r.provider&&r.provider.id&&(e.isSupportedSecret(r.value,r.provider.id)?n.push(r):i.add(r));try{s=await e.resolveSecrets(n.map(e=>({secretId:e.value,...e?.metadata?.role?{assumedRole:e.metadata.role}:{},...e?.metadata?.version?{version:e.metadata.version}:{},...e?.metadata?.secretType?{secretType:e.metadata.secretType}:{},...e?.metadata?.secretKey?{secretKey:e.metadata.secretKey}:{},vaultId:e.provider.id})),r)}catch(e){if(e instanceof l)return!0;throw e}for(let[e,[t,r]]of Object.entries(s))if(r.success)n[e].value=r.value;else{if(i.add(n[e]),null==r.error)continue;pm.logger.warn("RuntimeExecutionService~startRun.resolveVaultVariables",{secretId:t,error:r.error.message})}for(let e of i)e.value="{{"+e.key+"}}";return!1}let{EventSanitizer:A}=r("./common/utils/eventSanitizer.js");function I(e,t,r){let s;if(e&&e.fileName&&(s=e.fileName||""),o.isEmpty(s)&&(s="response",s=e&&e.mimeType?`${s}${function(e){for(var t=[{typeSubstring:"text",extension:".txt"},{typeSubstring:"json",extension:".json"},{typeSubstring:"javascript",extension:".js"},{typeSubstring:"pdf",extension:".pdf"},{typeSubstring:"png",extension:".png"},{typeSubstring:"jpg",extension:".jpg"},{typeSubstring:"jpeg",extension:".jpg"},{typeSubstring:"gif",extension:".gif"},{typeSubstring:"excel",extension:".xls"},{typeSubstring:"zip",extension:".zip"},{typeSubstring:"compressed",extension:".zip"},{typeSubstring:"audio/wav",extension:".wav"},{typeSubstring:"tiff",extension:".tiff"},{typeSubstring:"shockwave",extension:".swf"},{typeSubstring:"powerpoint",extension:".ppt"},{typeSubstring:"mpeg",extension:".mpg"},{typeSubstring:"quicktime",extension:".mov"},{typeSubstring:"html",extension:".html"},{typeSubstring:"css",extension:".css"}],r=0;r<t.length;r++)if(e.indexOf(t[r].typeSubstring)>-1)return t[r].extension;return""}(e.mimeType)}`:s),u){let e=new Blob([t]),o=URL.createObjectURL(e),n=document.createElement("a");return n.setAttribute("href",o),n.setAttribute("download",s),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),e=null,r(null,!0)}s=P(s,{replacement:"-"}),"darwin"===process.platform&&h.focus({steal:!0}),g.showSaveDialog({title:"Select path to save file",defaultPath:s,properties:["treatPackageAsDirectory"]}).then(e=>{if(e.canceled)return r(null,!1);d.writeFile(e.filePath,t,e=>r(e,!0))}).catch(r)}function O(e,t=o.noop){if(!e||!j[e])return;let r=j[e];r.host&&r.host.dispose&&r.host.dispose(),j[e]=null,t({id:e,event:"__dispose__"})}function L(e,t){if(E[e]){E[e].abort(),delete E[e],t({id:e,event:"__dispose__"});return}if(!e||!j[e])return;let r=j[e];r.aborter&&r.aborter.abort(),r.abort(),r.processor.call("abort",[null]),O(e,t)}function F(e){e&&j[e]&&j[e].pause()}function U(e){e&&j[e]&&j[e].resume()}async function D(e,t,r,n={},l,c,u){let d,p,m=new T.Collection(t);if(l&&(d=new v(l,{programmaticAccess:n.cookieConfiguration,readFromDB:!o.get(e,"cookie.runtimeWithEmptyJar",!1),writeToDB:!o.get(e,"cookie.disableRealtimeWrite",!1),onCookieAccessDenied:t=>{let r=`Unable to access "${t}" cookie store. Try whitelisting the domain in "Manage Cookies" screen. View more detailed instructions in the Learning Center: https://go.pstmn.io/docs-cookies`;u({name:"log",namespace:"console",data:{id:e.id,cursor:{},level:"warn",messages:[r]}})}}),o.set(n,["requester","cookieJar"],d)),n.fileResolver&&w){let{workingDir:e,insecureFileRead:t,fileWhitelist:r}=n.fileResolver;o.set(n,"fileResolver",new w(e||M,t,r))}if(n.script&&n.script.isPackageResolverEnabled){let e=new C(h.getPath("temp"),t?.info?._postman_id);o.set(n,"script.packageResolver",e.resolvePackages)}if(n&&(n.requester||(n.requester={}),n.requester.authorizer||(n.requester.authorizer={}),n.requester.authorizer.refreshOAuth2Token=pm.refreshTokenManager&&pm.refreshTokenManager.refreshToken,n.useSystemProxy&&k&&(n.systemProxy=k),n.proxies&&(n.proxies=new T.ProxyConfigList({},n.proxies)),n.certificates=new T.CertificateList({},n.certificates)),r.secrets?.some(e=>e.provider?.id)){let t=new AbortController;if(E[e.id]=t,await q(c,r.secrets,t.signal))return void u({id:e.id,event:"abort"});delete E[e.id]}let g=o.get(n,"script.allowVaultInScript",!1),f=o.get(t,"info._postman_id",null),y=[],b={id:"vault",prefix:"vault:",_allowScriptAccess:t=>{var r,o,s,n,i;return r=g,o=c,s=t,n=f,i=e.id,r?new Promise(e=>{if(!o&&!o.isScriptManagerInitialized())return e(r);o.storeActionCallback(i,e),o.emit({event:"vault-consent-required",data:{requestId:s,collectionId:n,executionId:i}})}):Promise.resolve(!1)},values:(r?.secrets||[]).map(e=>({enabled:e.enabled,type:e.type,key:e.key,value:e.value,_domains:e.domains,shouldMaskInConsole:e.shouldMaskInConsole}))};b&&b.values&&b.values.forEach(e=>{"secret"==e.type&&s(e.value)&&e.shouldMaskInConsole&&y.push(e.value)});let x=new A(y);p=new i(e.schema,(t,r,o)=>{try{r=x.sanitizeRuntimeEvent(t,r),u({id:e.id,event:t,data:r,refs:o})}catch(e){pm.logger.error("RuntimeExecutionService~eventSanitizer.sanitizeRuntimeEvent",e)}}),r.environment&&(n.environment=new T.VariableScope(r.environment)),r.globals&&(n.globals=new T.VariableScope(r.globals)),r.secrets&&(n.vaultSecrets=new T.VariableScope(b)),r.localVariables&&(n.localVariables=r.localVariables);let _=process?.memoryUsage().heapUsed;R.run(m,n,function(t,r){var o;if(t){pm.logger.error("RuntimeExecutionService~startRun - Error in starting the run",t),u({id:e.id,event:"__dispose__",error:!0});return}o=e.id,r.processor=p,j[o]=r,p.intercept("beforeRequest",(t,r,o,s,n)=>{var i;i=e.id,j[i]&&(j[i].aborter=n)}),p.intercept("response",(t,r,o)=>{var s;j[s=e.id]&&delete j[s].aborter,!t&&o&&e.download&&I(o.contentInfo(),o.stream,(e,t)=>{(e||t)&&p.call("download",[e])})}),p.intercept("done",()=>{if(a("collectionrun","heap_memory_usage",process.memoryUsage().heapUsed-_),e.cookie&&e.cookie.saveAfterRun&&d&&"function"==typeof d.updateStore)return void d.updateStore(()=>{O(e.id,u)});O(e.id,u)}),r.start(p.handlers())})}function N(e,t={},r,s){let n=new T.Request(e),i=o.pick(t,["implicitCacheControl","implicitTraceHeader","protocolProfileBehavior"]);!(i.protocolProfileBehavior&&i.protocolProfileBehavior.disableCookies)&&v&&(i.cookieJar=new v(r,{readFromDB:!0,writeToDB:!1}));try{x(n,i,(e,t)=>{s(e,t&&t.toJSON())})}catch(e){pm.logger.error("RuntimeExecutionService~previewRequest.dryRunRequest",e)}}function z(e,t){return!!new w(e)._resolve(t,!1)}function B(e,t,r){let o=h.getPath("temp"),s=m.join(o,e);n.waterfall([e=>d.unlink(s,()=>e()),e=>d.writeFile(s,t,e)],e=>{r(e&&new S(e),s)})}function H(e,t){d.readFile(e,(e,r)=>{if(!e)try{let e;r=r.toString((e=r,c[f.detect(e)]))}catch(t){e=Error("Failed to detect encoding of the file content")}return t(e&&new S(e),r)})}function J(e,t,r){if(!e)return r();let o=t?d.constants.R_OK|d.constants.W_OK:d.constants.R_OK;d.access(e,o,e=>{r(e&&new S(e))})}function W(e,t){if(!e)return t();y.fromPartition(e).clearStorageData({storages:["cookies"]}).then(()=>t&&t()).catch(e=>t&&t(new S(e)))}function V(e,{url:t,headers:r,protocols:s=[],options:n={},certificates:i={},workingDir:a},l){let c=a||M,u=new b(t,s,o.assign(n,{headers:r,certificates:i,cwd:c}));$[e]=u,u.onOpen=({protocol:t,extensions:r},o,s)=>l({connectionId:e,event:"open",data:{request:o,response:s,meta:{protocol:t,extensions:r}}}),u.onUpgrade=(t,r)=>l({connectionId:e,event:"upgrade",data:{request:t,response:r}}),u.onMessage=(t,r)=>l({connectionId:e,event:"message",data:{message:t,meta:r}}),u.onError=(t,r,o)=>l({connectionId:e,event:"error",data:{error:t,request:r,response:o}}),u.onClose=(t,r)=>l({connectionId:e,event:"close",data:{code:t,reason:r}}),u.onReconnect=()=>l({connectionId:e,event:"reconnect"}),u.onEnd=(t,r)=>{l({connectionId:e,event:"end",data:{code:t,reason:r,aborted:u.isConnectionAborted}}),delete $[e]}}function Q(e,t,r={},o){if(!e)return;let s=$[e];s&&s.send(t,r,o)}function G(e){if(!e)return;let t=$[e];t&&(t.close(1e3),delete $[e])}function K(e=[]){e.forEach(e=>{let t=$[e];t&&t.close()})}function X(e,{url:t,headers:r,listeners:s=[],options:n={},certificates:i={},workingDir:a},l){let c=a||M,u=new _(t,s,o.assign(n,{headers:r,certificates:i,cwd:c}));$[e]=u,u.onConnect=(t,r)=>l({connectionId:e,event:"connect",data:{request:t,response:r}}),u.onMessage=(t,r)=>l({connectionId:e,event:"message",data:{message:t,meta:r}}),u.onError=(t,r,o)=>l({connectionId:e,event:"error",data:{error:t,request:r,response:o}}),u.onReconnect=()=>l({connectionId:e,event:"reconnect"}),u.onEnd=t=>{l({connectionId:e,event:"end",data:{reason:t,aborted:u.isConnectionAborted}}),delete $[e]}}function Y(e,t,r,o,s){if(!e)return;let n=$[e];n&&n.publish(t,r,o,s)}function Z(e,t,r){if(!e)return;let o=$[e];o&&o.subscribe(t,r)}function ee(e,t,r){if(!e)return;let o=$[e];o&&o.unsubscribe(t,r)}function et(e){if(!e)return;let t=$[e];t&&(t.disconnect(),delete $[e])}function er(e,t,r){let o=e.substring(0,e.lastIndexOf("/"));d.existsSync(o)||d.mkdirSync(o,{recursive:!0}),d.writeFile(e,t,e=>r(e,!0))}function eo(e,t,r){e=m.resolve(h.getPath("temp"),e);let o=m.dirname(e);d.existsSync(o)||d.mkdirSync(o,{recursive:!0}),d.writeFile(e,t,e=>r(e,!0))}function es(e,t){let r=e.substring(0,e.lastIndexOf("/"));if(!d.existsSync(r))return t(null,!1);d.unlink(e,e=>e?t(e,!1):t(null,!0))}function en(e,t){if(!d.existsSync(e))return t(null,!0);d.rmdirSync(e,{recursive:!0,force:!0},e=>e?t(e,!1):t(e,!0))}function ei(e,t){let r=m.join(h.getPath("temp"),e);if(!d.existsSync(r))return t(null,!0);d.rmdirSync(r,{recursive:!0,force:!0},e=>e?t(e,!1):t(e,!0))}e.exports=function(){let e=r("./node_modules/postman-runtime/index.js"),t=r("./common/services/GRPCClient.js"),o=r("./common/services/GraphQLClient.js"),s=r("./common/services/MQTTClient.js"),n=r("./common/services/MCPClient.js"),i=r("./common/services/LLMClient.js"),a=r("./common/services/FileSystem.js"),l=r("./common/services/RuntimeClientUtilities.js"),{connectToMCP:c,toggleTool:j,callTool:E,bulkConnectToMCP:$,getToolsForServer:q,getToolsByOrigin:A,disconnectFromMCP:O,getServerById:ea,getServersByOrigin:el,cancelMCPRequest:ec}=r("./common/services/MCPConnectionManager.js");return d=r("fs"),p=r("os"),m=r("path"),f=r("./node_modules/chardet/lib/index.js"),h=r("electron").app,g=r("electron").dialog,y=r("electron").session,P=r("./node_modules/sanitize-filename/index.js"),T=r("./node_modules/postman-collection/index.js"),S=r("./node_modules/serialised-error/index.js"),b=r("./common/services/WebSocketClient.js"),_=r("./common/services/SocketIOClient.js"),v=r("./common/services/CookieJar.js"),k=r("./utils/getSystemProxy.js"),w=r("./common/utils/postmanFs.js"),C=r("./common/utils/packageResolver.js"),R=new e.Runner,x=e.Requester&&e.Requester.dryRun,M=m.join(p.homedir(),"Postman","files"),u=!1,{startRun:D,stopRun:L,pauseRun:F,resumeRun:U,previewRequest:N,wsConnect:V,wsSend:Q,wsDisconnect:G,wsBulkDisconnect:K,socketIOConnect:X,socketIOPublish:Y,socketIOSubscribe:Z,socketIOUnsubscribe:ee,socketIODisconnect:et,grpc:new t(M),graphql:new o(M),mqtt:new s(M),mcp:new n(M),llm:new i(M),fileSystem:new a(M),runtimeUtils:new l(M),connectToMCP:c,toggleTool:j,callTool:E,bulkConnectToMCP:$,getToolsForServer:q,getToolsByOrigin:A,disconnectFromMCP:O,getServerById:ea,getServersByOrigin:el,cancelMCPRequest:ec,isInWorkingDir:z,createTemporaryFile:B,readFile:H,accessFile:J,defaultWorkingDir:M,saveStreamToFile:I,clearAllElectronCookies:W,saveCloudFileLocally:er,deleteSavedCloudFile:es,deleteCloudFileDir:en,deleteScriptFileDir:ei,saveScriptFileLocally:eo}},e.exports.Browser=async function(){let e=await r.e("postman-runtime").then(r.t.bind(r,"./node_modules/postman-runtime/dist/index.js",23));return f=r("./node_modules/chardet/lib/index.js"),T=r("./node_modules/postman-collection/index.js"),S=r("./node_modules/serialised-error/index.js"),v=r("./common/services/CookieJar.js"),R=new e.Runner,x=e.Requester&&e.Requester.dryRun,u=!0,{startRun:D,stopRun:L,pauseRun:F,resumeRun:U,previewRequest:N,saveStreamToFile:I}},e.exports.Test={_resolveVaultVariables:q}},"./common/services/SocketIOClient.js":function(e,t,r){let o=r("./node_modules/async/lib/async.js"),s=r("./node_modules/file-type/index.js"),n=r("./node_modules/socket.io-client-v2/lib/index.js"),i=r("./node_modules/socket.io-client-v4/build/cjs/index.js"),a=r("http").Agent,l=r("https").Agent,c=r("./node_modules/serialised-error/index.js"),u=r("./common/utils/postmanFs.js"),{promisify:d}=r("util"),p={2:n,3:i,4:i};async function h(e,{cwd:t}){let r=new u(t),o=d(r.readFile.bind(r));return await o(e)}async function m(e,{cwd:t}){let[r,o,s,n]=await Promise.all([e.ca?h(e.ca,{cwd:t}):void 0,e.cert?h(e.cert,{cwd:t}):void 0,e.key?h(e.key,{cwd:t}):void 0,e.pfx?h(e.pfx,{cwd:t}):void 0]);return{ca:r,cert:o,key:s,pfx:n,passphrase:e.passphrase}}function g(e,t="3"){return String(e&&e.message).includes("v2.x with a v3.x")&&(e=Error(`It seems you are trying to reach a Socket.IO server in v2.x with a v${t}.x client. Switch the client version from request settings.`)),new c(e)}function f(e){let t=e.split("\r\n"),r=[];for(let e=1,o=t.length-2;e<o;e++){let o=t[e].indexOf(":");r.push({key:t[e].slice(0,o),value:t[e].slice(o+2)})}return r}e.exports=class{constructor(e,t=[],r={}){this.clientVersion=r.version||"3",this.ioClient=p[r.version]||i,this.listeners=new Set(t),this.options={extraHeaders:r.headers,path:r.path||"/socket.io",timeout:0===r.handshakeTimeout?3e5:r.handshakeTimeout,cwd:r.cwd,certificates:r.certificates,strictSSL:r.strictSSL},this.isConnectionAborted=!1,this._reconnectAttempts=-1,this._retryCount="number"!=typeof r.retryCount?0:r.retryCount,this._retryDelay="number"!=typeof r.retryDelay?5e3:r.retryDelay,setImmediate(()=>{if(!(e&&"string"==typeof e))return this.onError(g(Error("Request URL is empty"))),this.onEnd();switch(e.substr(0,e.indexOf("://")).toLowerCase()){case"ws":case"wss":case"http":case"https":break;default:e="ws://"+e}try{this.url=new URL(e),this._connect()}catch(e){return this.onError(g(e)),this.onEnd()}})}async _connect(){let{cwd:e,certificates:t,strictSSL:r=!1,...o}=this.options,s=t?await m(t,{cwd:e}):{},n=await this._getRequestAgent({rejectUnauthorized:r,...s}),i={...o,forceNew:!0,autoConnect:!1,reconnection:!1,transports:["websocket"],agent:n};this.socket=this.ioClient(this.url.href,i),this.socket.connect(),this.socket.on("connect",()=>{this.onConnect(this._request,this._response),this._reconnectAttempts=0,this._request=this._response=null,this.listeners.forEach(e=>this.subscribe(e))}),this.socket.on("disconnect",e=>{if(this._reconnectAttempts||this.onDisconnect(e),"io client disconnect"===e||this.isConnectionAborted||-1===this._reconnectAttempts)return this.onEnd(e);this._reconnect(e)}),this.socket.on("connect_error",e=>{if(this.isConnectionAborted)return;if(this._reconnectAttempts>0&&this._reconnectAttempts<this._retryCount)return this._reconnect();let t=g(e.description&&e.description.error||e,this.clientVersion);t.cert=null,this.onError(t,this._request,this._response),this.onEnd()})}_reconnect(e){if(this.socket.removeAllListeners(),this._reconnectAttempts>=this._retryCount)return this.onEnd(e);setTimeout(()=>{this._connect()},this._retryDelay),this.onReconnect(++this._reconnectAttempts,this._retryDelay)}async _getRequestAgent({ca:e,cert:t,key:r,pfx:o,passphrase:s,rejectUnauthorized:n}){let{protocol:i,host:c}=this.url,u=this,d="https:"===i||"wss:"===i,p=new(d?l:a)(d?{rejectUnauthorized:n,ca:e,cert:t,key:r,pfx:o,passphrase:s}:{}),h=p.createConnection;return p.createConnection=function(){let e=h.apply(this,arguments);return e.on("lookup",()=>{let t=e._httpMessage;u._request={method:t.method,href:`${t.agent.protocol}//${c}${t.path}`,headers:f(t._header),httpVersion:"1.1"}}),e.once("data",e=>{let t=e.toString(),[r,o,s,n=""]=/^HTTP\/(\d.\d) (\d{3})( .*)?$/.exec(t)||[];s&&(u._response={statusCode:parseInt(s),statusMessage:n.substring(1),headers:f(t),httpVersion:o})}),e},p}_onMessage=e=>(...t)=>{o.map(t,(e,t)=>{let r="text/plain",o;if(Buffer.isBuffer(e))return void s.fromBuffer(e).then(({mime:e,ext:t}={})=>{r=e||"application/octet-stream",o=t||"bin"}).catch(()=>{r="application/octet-stream",o="bin"}).finally(()=>{t(null,{value:e,mimeType:r,ext:o})});"string"!=typeof e&&(e=JSON.stringify(e),r="application/json"),t(null,{value:e,mimeType:r})},(t,r)=>{t||this.onMessage(r,{event:e})})};publish(e,t,r={},o){o||"function"!=typeof r||(o=r,r={}),t=t.map(({value:e,mimeType:t})=>{if("application/octet-stream"===t&&"string"==typeof e){let t=Buffer.from(e,"base64");e=t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}return"application/json"===t&&(e=JSON.parse(e)),e}),r.acknowledgement&&t.push(this._onMessage(e)),this.socket.emit(e,...t),o&&o()}subscribe(e,t){this.socket&&(this.socket.on(e,this._onMessage(e)),this.listeners.add(e),t&&t())}unsubscribe(e,t){this.socket&&(this.socket.removeAllListeners(e),this.listeners.delete(e),t&&t())}disconnect(){this.socket?.connected||(this.isConnectionAborted=!0,this.onEnd()),this.listeners.clear(),this.socket?.disconnect()}close(){this.disconnect()}onConnect(e,t){}onReconnect(e,t){}onDisconnect(e){}onEnd(e){}onError(e,t,r){}onMessage(e,t){}}},"./common/services/WebSocketClient.js":function(e,t,r){let{URL:o}=r("url"),s=r("./node_modules/postman-ws/index.js"),n=r("./node_modules/file-type/index.js"),i=r("./node_modules/serialised-error/index.js"),a=r("./common/utils/postmanFs.js"),{promisify:l}=r("util");async function c(e,{cwd:t}){let r=new a(t);return l(r.readFile.bind(r))(e)}async function u(e,{cwd:t}){let[r,o,s,n]=await Promise.all([e.ca?c(e.ca,{cwd:t}):void 0,e.cert?c(e.cert,{cwd:t}):void 0,e.key?c(e.key,{cwd:t}):void 0,e.pfx?c(e.pfx,{cwd:t}):void 0]);return{ca:r,cert:o,key:s,pfx:n,passphrase:e.passphrase}}function d(e){return new i(e)}e.exports=class{constructor(e,t=[],r={}){"number"!=typeof r.retryCount&&(r.retryCount=0),"number"!=typeof r.retryDelay&&(r.retryDelay=5e3),this.protocols=t,this.options={followRedirects:!0,...r},this.reconnectAttempts=-1,this.isConnectionAborted=!1,setImmediate(()=>{if(!(e&&"string"==typeof e))return this.onError(d(Error("Request URL is empty"))),this.onEnd();e.startsWith("ws://")||e.startsWith("wss://")||(e="ws://"+e);try{this.url=new o(e),this._open()}catch(e){return this.onError(d(e)),this.onEnd()}})}async _open(){let{cwd:e,certificates:t,strictSSL:r,...o}=this.options,i=t?await u(t,{cwd:e}):{};if(this.isConnectionAborted)return;let a={...o,rejectUnauthorized:r,...i},l=this.ws=new s(this.url,this.protocols,a);l.on("upgrade",()=>{if(l._debug){let e=l._debug[0].request,t=l._debug[l._debug.length-1].response;return this.onUpgrade(e,t)}this.onUpgrade()}),l.on("open",()=>{if(this.reconnectAttempts=0,!l._debug)return this.onOpen(l);let e=l._debug[0].request,t=l._debug[l._debug.length-1].response;l._debug=null,this.onOpen(l,e,t)}),l.on("close",(e,t)=>{if(this.reconnectAttempts||this.onClose(e,t),1e3===e||this.isConnectionAborted||-1===this.reconnectAttempts)return this.onEnd(e,t);this._reconnect(e,t)}),l.on("message",e=>{let t={mimeType:"text/plain",size:0,timestamp:Date.now()};if("string"==typeof e)return t.size=Buffer.byteLength(e),function(e){switch((e=e.trim()).charAt(0)+e.charAt(e.length-1)){case"[]":case"{}":case"0}":case"4]":return!0;default:return!1}}(e)&&(t.mimeType="application/json"),this.onMessage(e,t);t.size=e.length,n.fromBuffer(e).then(({mime:e,ext:r}={})=>{t.mimeType=e||"application/octet-stream",t.ext=r||"bin"}).catch(()=>{t.mimeType="application/octet-stream",t.ext="bin"}).finally(()=>{this.onMessage(e,t)})}),l.on("error",e=>{if(!this.isConnectionAborted&&(!(this.reconnectAttempts>0)||!(this.reconnectAttempts<this.options.retryCount))){if(l._debug){let t=l._debug[0].request,r=l._debug[l._debug.length-1].response;l._debug=null;let o=d(e);return o.cert=null,this.onError(o,t,r)}this.onError(d(e))}})}_reconnect(e,t){if(this.ws&&this.ws.removeAllListeners(),this.reconnectAttempts>=this.options.retryCount)return this.onEnd(e,t);setTimeout(()=>{this._open()},this.options.retryDelay),this.onReconnect(++this.reconnectAttempts,this.options.retryDelay)}send(e,{messageType:t,...r}={},o){if("binary"===t&&"string"==typeof e){let t=Buffer.from(e,"base64");e=t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}this.ws.send(e,r,o)}close(e,t){if(!this.ws){this.isConnectionAborted=!0,this.onEnd();return}1!==this.ws.readyState&&(this.isConnectionAborted=!0),this.ws.close(e,t)}onClose(e,t){}onEnd(){}onError(e){}onMessage(e,t){}onOpen(){}onReconnect(e,t){}onUpgrade(e){}}},"./common/utils/eventSanitizer.js":function(e,t,r){let o=r("./node_modules/postman-url-encoder/encoder/index.js"),s=r("./node_modules/teleport-javascript/esm/index.js"),n=r("./node_modules/lodash/lodash.js"),i={url:{protocol:!1},method:!1,body:{mode:!1}},a={cursor:!1,response:!1,item:!1,request:i,history:{execution:{verbose:!1,sessions:!1,data:[{response:!1,request:i,session:!1}]}}},l={item:{visualizerData:!1},script:{cursor:!1,mutations:!1,event:!1},console:{cursor:!1,level:!1,messages:[(e,t)=>{try{let r=s.parse(t),o=e(r);return s.stringify(o)}catch(e){return pm.logger.error("EventSanitizer~console.messages Error while parsing value",e),t}}]},assertion:{cursor:!1,assertions:[{error:{operator:!1}}]},responseStart:a,response:a,request:a},c="*****";class u{constructor(e){this.words=e;let t=new Set;for(let r of e)u._getPossibleWordVariations(r).forEach(e=>{e.length>=3&&t.add(e)});if(0==t.size)this.sanitizerRegex=null;else{let e=[...t].map(u._escapeRegex).join("|");this.sanitizerRegex=RegExp(e,"ig")}this.knowns=new WeakSet}_shouldScan(){return null!=this.sanitizerRegex}_stripVaultFunctions(e){if(!e?.mutations?.vaultSecrets)return e;let t={...e};return t.mutations.vaultSecrets._&&t.mutations.vaultSecrets._.allowScriptAccess&&delete t.mutations.vaultSecrets._.allowScriptAccess,t}sanitizeRuntimeEvent(e,t){return this._shouldScan()?this._sanitizeAgainstSchema(l[e],t):this._stripVaultFunctions(t)}_sanitizeString(e){return this._shouldScan()?e.replace(this.sanitizerRegex,c):e}_sanitizeAny(e,t=!1){if(this.knowns.has(e))return e;if("string"==typeof e)return this._sanitizeString(e);if(Array.isArray(e))for(let[r,o]of(this.knowns.add(e),e.entries()))e[r]=this._sanitizeAny(o,t);else if(n.isPlainObject(e))for(let[r,o]of(this.knowns.add(e),Object.entries(e)))t&&(delete e[r],r=this._sanitizeString(r)),e[r]=this._sanitizeAny(o,t);return e}_sanitizeAgainstSchema(e,t){if(t=this._stripVaultFunctions(t),!1==e)return t;if(!0==e||void 0==e||null==e)return this._sanitizeAny(t);if("function"==typeof e)return e(e=>this._sanitizeAny(e,!0),t);if(Array.isArray(t))if(!Array.isArray(e)||1!=e.length)return this._sanitizeAny(t);else{let r=e[0];for(let[e,o]of t.entries())t[e]=this._sanitizeAgainstSchema(r,o);return t}if(!n.isPlainObject(t)||!n.isPlainObject(e))return this._sanitizeAny(t);for(let[r,o]of Object.entries(t))void 0!==e[r]?t[r]=this._sanitizeAgainstSchema(e[r],o):t[r]=this._sanitizeAny(o);return t}static _escapeRegex(e){return e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}static _getBase64Representations(e){let t=[];for(let r of[0,1,2]){let o=3*Math.floor((e.length-r)/3),s=e.slice(r,r+o),n=Buffer.from(s).toString("base64");t.push(n)}return t}static _getPossibleWordVariations(e){return[e,encodeURIComponent(e),o.encodeQueryParam(e),...u._getBase64Representations(e)]}}e.exports={EventSanitizer:u,PLACEHOLDER:c}},"./common/utils/packageResolver.js":function(e,t,r){let o=r("fs"),s=r("./node_modules/uuid/index.js"),n=r("path"),i=r("./common/utils/sanitizePackageId.js");e.exports=class{constructor(e,t){this.scriptContentCache={},this.tempDirPath=e,this.collectionId=t,this.resolvePackages=this.resolvePackages.bind(this)}resolvePackages({packages:e},t){if(!e||!Object.keys(e).length)return t(null,{});let r=s.v4(),a={},l={},c;if(Object.entries(e).forEach(([e,t])=>{let r=!1;try{let s=`./scriptPackageFiles/${i(t.id)}`,c=n.join(this.tempDirPath,s);r=o.existsSync(c),this.scriptContentCache[e]?l[e]={data:this.scriptContentCache[e]}:a[e]={id:t.id,forceSave:!r}}catch(e){pm.logger.error("PackageResolver~resolvePackages: Error checking if package is saved locally",e,{context:pm.logger.getContext("PackageResolver","runtime")})}}),0===Object.keys(a).length)return t(null,l);let u=this._subscribeToPackageEvents(r,(e,r)=>{if(e)return t(e,null);Object.assign(r,l),clearTimeout(c),t(null,r)});this._publishPackageFetchEvent(a,r),c=this._cleanupEventListener(u,t)}_subscribeToPackageEvents(e,t){let r=pm.eventBus.channel("package-ipc-event").subscribe(o=>{let{name:s,data:n}=o??{};"package-fetch-failed"===s&&n.id===e&&(r(),t(Error("Cloud package fetch failed"))),"package-fetch-completed"===s&&n.id===e&&(r(),t(null,this._processFetchedData(n.packages,n.packageErrors)))});return r}_processFetchedData(e,t){let r={};return Object.entries(e).forEach(([e,s])=>{s||(r[e]={error:t?.[e]??`Cannot find package ${e}`},pm.logger.error("PackageResolver~_processFetchedData: Error finding package",Error(`No path found for package ${e}`),{context:pm.logger.getContext("PackageResolver","runtime")}));try{let t=n.join(this.tempDirPath,s),i=o.readFileSync(t,"utf8");r[e]={data:i},this.scriptContentCache[e]=i}catch(e){pm.logger.error("PackageResolver~_processFetchedData: Error reading file",e,{context:pm.logger.getContext("PackageResolver","runtime")})}}),r}_publishPackageFetchEvent(e,t){pm.eventBus.channel("package-ipc-event").publish({name:"package-fetch-start",data:{packages:e,id:t,collectionId:this.collectionId}})}_cleanupEventListener(e,t){return setTimeout(()=>{e(),t(Error("Cloud package fetch timed out"))},6e4)}}},"./common/utils/requestLogging.js":function(e){e.exports={buildRequest:function(e,t){return{headers:e.headers&&"function"==typeof e.headers.entries?Array.from(e.headers.entries()).map(([e,t])=>({key:e,value:t})):"object"==typeof e.headers&&null!==e.headers?Object.entries(e.headers).map(([e,t])=>({key:e,value:t})):[],method:e.method,url:t,...e.body?{body:e.body}:{}}},buildResponse:function(e,t,r){return{headers:Array.from(e.headers.entries()).map(([e,t])=>({key:e,value:t})),code:e.status,statusCode:e.status,responseTime:t,status:e.statusText,redirected:e.redirected,type:e.type,...r?{body:r}:{},contentInfo:{charset:"utf-8"}}},createHistory:function(e){return{execution:{data:[],sessions:{[e]:{}}}}},addToHistory:function(e,t,r,o){e.execution.data.push({request:t,response:r,session:{id:o,reused:!1}})},getLocationHeader:function(e){return e.get("Location")??e.get("location")},resolveLocation:function(e,t){if("string"==typeof e&&e.startsWith("/")){let r="string"==typeof t?new URL(t):t;return r.protocol+"//"+r.host+e}return e}}},"./common/utils/sanitizePackageId.js":function(e,t,r){let o=r("./node_modules/sanitize-filename/index.js");e.exports=function(e){let t=o(e,{replacement:"-"});return`${t}/${t}`}},"./node_modules/postman-runtime/lib sync recursive ^.*\\/package\\.json$":function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id="./node_modules/postman-runtime/lib sync recursive ^.*\\/package\\.json$",e.exports=t}};